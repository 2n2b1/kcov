<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Coverage - kcov</title>
  <link rel="stylesheet" type="text/css" href="bcov.css"/>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr><td class="title">Coverage Report</td></tr>
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
  <tr>
    <td width="100%">
      <table cellpadding="1" border="0" width="100%">
        <tr>
          <td class="headerItem" width="20%">Command:</td>
          <td class="headerValue" width="80%" colspan=6>kcov</td>
        </tr>
        <tr>
          <td class="headerItem" width="20%">Date:</td>
          <td class="headerValue" width="15%">2014-03-01 10:11:51</td>
          <td width="5%"></td>
          <td class="headerItem" width="20%">Instrumented&nbsp;lines:</td>
          <td class="headerValue" width="10%">125</td>
        </tr>
        <tr>
          <td class="headerItem" width="20%">Code&nbsp;covered:</td>
          <td class="coverPerLeftMed" width="15%">49.6%</td>
          <td width="5%"></td>
          <td class="headerItem" width="20%">Executed&nbsp;lines:</td>
          <td class="headerValue" width="10%">62</td>
        </tr>
      </table>
    </td>
  </tr>
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
</table>
<pre class="source">
<span class="lineNum">    1</span>              : #include &lt;sched.h&gt; </span>
<span class="lineNum">    2</span>              : #include &lt;sys&#047;types.h&gt; </span>
<span class="lineNum">    3</span>              : #include &lt;string.h&gt; </span>
<span class="lineNum">    4</span>              : #include &lt;stdio.h&gt; </span>
<span class="lineNum">    5</span>              : #include &lt;stdint.h&gt; </span>
<span class="lineNum">    6</span>              : #include &lt;sys&#047;types.h&gt; </span>
<span class="lineNum">    7</span>              : #include &lt;sys&#047;stat.h&gt; </span>
<span class="lineNum">    8</span>              : #include &lt;fcntl.h&gt; </span>
<span class="lineNum">    9</span>              : #include &lt;stdarg.h&gt; </span>
<span class="lineNum">   10</span>              : #include &lt;unistd.h&gt; </span>
<span class="lineNum">   11</span>              : #include &lt;time.h&gt; </span>
<span class="lineNum">   12</span>              :  </span>
<span class="lineNum">   13</span>              : #include &quot;utils.hh&quot; </span>
<span class="lineNum">   14</span>              :  </span>
<span class="lineNum">   15</span>              : #include &lt;sstream&gt; </span>
<span class="lineNum">   16</span>              :  </span>
<span class="lineNum">   17</span>              : int g_kcov_debug_mask = STATUS_MSG; </span>
<span class="lineNum">   18</span>              :  </span>
<span class="lineNum">   19</span>              : void *read_file(size_t *out_size, const char *fmt, ...) </span>
<span class="lineNum">   20</span><span class="linePartCov">      1  /   2: { </span>
<span class="lineNum">   21</span>              : 	struct stat buf; </span>
<span class="lineNum">   22</span>              : 	char path[2048]; </span>
<span class="lineNum">   23</span>              : 	va_list ap; </span>
<span class="lineNum">   24</span>              : 	void *data; </span>
<span class="lineNum">   25</span>              : 	size_t size; </span>
<span class="lineNum">   26</span>              : 	FILE *f; </span>
<span class="lineNum">   27</span>              : 	int r; </span>
<span class="lineNum">   28</span>              :  </span>
<span class="lineNum">   29</span>              : 	&#047;* Create the filename *&#047; </span>
<span class="lineNum">   30</span><span class="lineCov">      1  /   1: 	va_start(ap, fmt); </span>
<span class="lineNum">   31</span><span class="lineCov">      1  /   1: 	r = vsnprintf(path, 2048, fmt, ap); </span>
<span class="lineNum">   32</span>              : 	va_end(ap); </span>
<span class="lineNum">   33</span>              :  </span>
<span class="lineNum">   34</span><span class="lineCov">      1  /   1: 	panic_if (r &gt;= 2048, </span>
<span class="lineNum">   35</span>              : 			&quot;Too long string!&quot;); </span>
<span class="lineNum">   36</span>              :  </span>
<span class="lineNum">   37</span><span class="lineCov">      1  /   1: 	if (lstat(path, &amp;buf) &lt; 0) </span>
<span class="lineNum">   38</span><span class="lineCov">      1  /   1: 		return NULL; </span>
<span class="lineNum">   39</span>              :  </span>
<span class="lineNum">   40</span><span class="lineCov">      1  /   1: 	size = buf.st_size; </span>
<span class="lineNum">   41</span><span class="lineCov">      1  /   1: 	data = xmalloc(size + 2); &#047;* NULL-terminate, if used as string *&#047; </span>
<span class="lineNum">   42</span><span class="lineCov">      1  /   1: 	f = fopen(path, &quot;r&quot;); </span>
<span class="lineNum">   43</span><span class="lineCov">      1  /   1: 	if (!f) </span>
<span class="lineNum">   44</span>              : 	{ </span>
<span class="lineNum">   45</span><span class="lineNoCov">      0  /   1: 		free(data); </span>
<span class="lineNum">   46</span><span class="lineNoCov">      0  /   1: 		return NULL; </span>
<span class="lineNum">   47</span>              : 	} </span>
<span class="lineNum">   48</span><span class="lineCov">      1  /   1: 	if (fread(data, 1, size, f) != size) </span>
<span class="lineNum">   49</span>              : 	{ </span>
<span class="lineNum">   50</span><span class="lineCov">      1  /   1: 		free(data); </span>
<span class="lineNum">   51</span><span class="lineCov">      1  /   1: 		data = NULL; </span>
<span class="lineNum">   52</span>              : 	} </span>
<span class="lineNum">   53</span><span class="lineCov">      1  /   1: 	fclose(f); </span>
<span class="lineNum">   54</span>              :  </span>
<span class="lineNum">   55</span><span class="lineCov">      1  /   1: 	*out_size = size; </span>
<span class="lineNum">   56</span>              :  </span>
<span class="lineNum">   57</span><span class="lineCov">      1  /   1: 	return data; </span>
<span class="lineNum">   58</span><span class="lineCov">      1  /   1: } </span>
<span class="lineNum">   59</span>              :  </span>
<span class="lineNum">   60</span>              : int write_file(const void *data, size_t len, const char *fmt, ...) </span>
<span class="lineNum">   61</span><span class="linePartCov">      1  /   2: { </span>
<span class="lineNum">   62</span>              : 	char path[2048]; </span>
<span class="lineNum">   63</span>              : 	va_list ap; </span>
<span class="lineNum">   64</span>              : 	FILE *fp; </span>
<span class="lineNum">   65</span><span class="lineCov">      1  /   1: 	int ret = 0; </span>
<span class="lineNum">   66</span>              :  </span>
<span class="lineNum">   67</span>              : 	&#047;* Create the filename *&#047; </span>
<span class="lineNum">   68</span><span class="lineCov">      1  /   1: 	va_start(ap, fmt); </span>
<span class="lineNum">   69</span><span class="lineCov">      1  /   1: 	vsnprintf(path, 2048, fmt, ap); </span>
<span class="lineNum">   70</span>              : 	va_end(ap); </span>
<span class="lineNum">   71</span>              :  </span>
<span class="lineNum">   72</span><span class="lineCov">      1  /   1: 	fp = fopen(path, &quot;w&quot;); </span>
<span class="lineNum">   73</span><span class="lineCov">      1  /   1: 	if (!fp) </span>
<span class="lineNum">   74</span><span class="lineNoCov">      0  /   1: 		return -1; </span>
<span class="lineNum">   75</span>              :  </span>
<span class="lineNum">   76</span><span class="lineCov">      1  /   1: 	if (fwrite(data, sizeof(uint8_t), len, fp) != len) </span>
<span class="lineNum">   77</span><span class="lineNoCov">      0  /   1: 		ret = -1; </span>
<span class="lineNum">   78</span><span class="lineCov">      1  /   1: 	fclose(fp); </span>
<span class="lineNum">   79</span>              :  </span>
<span class="lineNum">   80</span><span class="lineCov">      1  /   1: 	return ret; </span>
<span class="lineNum">   81</span><span class="lineCov">      1  /   1: } </span>
<span class="lineNum">   82</span>              :  </span>
<span class="lineNum">   83</span>              : const char *dir_concat(const char *dir, const char *filename) </span>
<span class="lineNum">   84</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">   85</span>              : 	size_t len; </span>
<span class="lineNum">   86</span>              : 	char *out; </span>
<span class="lineNum">   87</span>              :  </span>
<span class="lineNum">   88</span><span class="lineNoCov">      0  /   1: 	if (dir == NULL) </span>
<span class="lineNum">   89</span><span class="lineNoCov">      0  /   1: 		return xstrdup(filename); </span>
<span class="lineNum">   90</span>              :  </span>
<span class="lineNum">   91</span><span class="lineNoCov">      0  /   1: 	len = strlen(dir) + strlen(filename) + 4; </span>
<span class="lineNum">   92</span><span class="lineNoCov">      0  /   1: 	out = (char *)xmalloc(len); </span>
<span class="lineNum">   93</span>              :  </span>
<span class="lineNum">   94</span><span class="lineNoCov">      0  /   1: 	xsnprintf(out, len, &quot;%s&#047;%s&quot;, dir, filename); </span>
<span class="lineNum">   95</span>              :  </span>
<span class="lineNum">   96</span><span class="lineNoCov">      0  /   1: 	return out; </span>
<span class="lineNum">   97</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">   98</span>              :  </span>
<span class="lineNum">   99</span>              : const char *get_home(void) </span>
<span class="lineNum">  100</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  101</span><span class="lineNoCov">      0  /   1: 	return getenv(&quot;HOME&quot;); </span>
<span class="lineNum">  102</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  103</span>              :  </span>
<span class="lineNum">  104</span>              :  </span>
<span class="lineNum">  105</span>              : int file_exists(const char *path) </span>
<span class="lineNum">  106</span><span class="lineCov">      1  /   1: { </span>
<span class="lineNum">  107</span>              : 	struct stat st; </span>
<span class="lineNum">  108</span>              :  </span>
<span class="lineNum">  109</span><span class="lineCov">      1  /   1: 	return lstat(path, &amp;st) == 0; </span>
<span class="lineNum">  110</span><span class="lineCov">      1  /   1: } </span>
<span class="lineNum">  111</span>              :  </span>
<span class="lineNum">  112</span>              : static void read_write(FILE *dst, FILE *src) </span>
<span class="lineNum">  113</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  114</span>              : 	char buf[1024]; </span>
<span class="lineNum">  115</span>              :  </span>
<span class="lineNum">  116</span><span class="lineNoCov">      0  /   2: 	while (!feof(src)) { </span>
<span class="lineNum">  117</span><span class="lineNoCov">      0  /   1: 		int n = fread(buf, sizeof(char), sizeof(buf), src); </span>
<span class="lineNum">  118</span>              :  </span>
<span class="lineNum">  119</span><span class="lineNoCov">      0  /   1: 		fwrite(buf, sizeof(char), n, dst); </span>
<span class="lineNum">  120</span>              : 	} </span>
<span class="lineNum">  121</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  122</span>              :  </span>
<span class="lineNum">  123</span>              : int concat_files(const char *dst_name, const char *file_a, const char *file_b) </span>
<span class="lineNum">  124</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  125</span>              : 	FILE *dst; </span>
<span class="lineNum">  126</span>              : 	FILE *s1, *s2; </span>
<span class="lineNum">  127</span><span class="lineNoCov">      0  /   1: 	int ret = -1; </span>
<span class="lineNum">  128</span>              :  </span>
<span class="lineNum">  129</span><span class="lineNoCov">      0  /   1: 	dst = fopen(dst_name, &quot;w&quot;); </span>
<span class="lineNum">  130</span><span class="lineNoCov">      0  /   1: 	if (!dst) </span>
<span class="lineNum">  131</span><span class="lineNoCov">      0  /   1: 		return -1; </span>
<span class="lineNum">  132</span><span class="lineNoCov">      0  /   1: 	s1 = fopen(file_a, &quot;r&quot;); </span>
<span class="lineNum">  133</span><span class="lineNoCov">      0  /   1: 	if (!s1) </span>
<span class="lineNum">  134</span><span class="lineNoCov">      0  /   1: 		goto out_dst; </span>
<span class="lineNum">  135</span><span class="lineNoCov">      0  /   1: 	s2 = fopen(file_b, &quot;r&quot;); </span>
<span class="lineNum">  136</span><span class="lineNoCov">      0  /   1: 	if (!s2) </span>
<span class="lineNum">  137</span><span class="lineNoCov">      0  /   1: 		goto out_s1; </span>
<span class="lineNum">  138</span>              :  </span>
<span class="lineNum">  139</span><span class="lineNoCov">      0  /   1: 	read_write(dst, s1); </span>
<span class="lineNum">  140</span><span class="lineNoCov">      0  /   1: 	read_write(dst, s2); </span>
<span class="lineNum">  141</span>              :  </span>
<span class="lineNum">  142</span><span class="lineNoCov">      0  /   1: 	fclose(s2); </span>
<span class="lineNum">  143</span>              : out_s1: </span>
<span class="lineNum">  144</span><span class="lineNoCov">      0  /   1: 	fclose(s1); </span>
<span class="lineNum">  145</span>              : out_dst: </span>
<span class="lineNum">  146</span><span class="lineNoCov">      0  /   1: 	fclose(dst); </span>
<span class="lineNum">  147</span>              :  </span>
<span class="lineNum">  148</span><span class="lineNoCov">      0  /   1: 	return ret; </span>
<span class="lineNum">  149</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  150</span>              :  </span>
<span class="lineNum">  151</span>              : unsigned long get_aligned(unsigned long addr) </span>
<span class="lineNum">  152</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  153</span><span class="lineNoCov">      0  /   1: 	return (addr &#047; sizeof(long)) * sizeof(long); </span>
<span class="lineNum">  154</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  155</span>              :  </span>
<span class="lineNum">  156</span>              : unsigned long get_aligned_4b(unsigned long addr) </span>
<span class="lineNum">  157</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  158</span><span class="lineNoCov">      0  /   1: 	return addr &amp; ~3; </span>
<span class="lineNum">  159</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  160</span>              :  </span>
<span class="lineNum">  161</span>              : std::string fmt(const char *fmt, ...) </span>
<span class="lineNum">  162</span><span class="lineCov">      2  /   2: { </span>
<span class="lineNum">  163</span>              : 	char buf[4096]; </span>
<span class="lineNum">  164</span>              : 	va_list ap; </span>
<span class="lineNum">  165</span>              : 	int res; </span>
<span class="lineNum">  166</span>              :  </span>
<span class="lineNum">  167</span><span class="lineCov">      1  /   1: 	va_start(ap, fmt); </span>
<span class="lineNum">  168</span><span class="lineCov">      1  /   1: 	res = vsnprintf(buf, sizeof(buf), fmt, ap); </span>
<span class="lineNum">  169</span>              : 	va_end(ap); </span>
<span class="lineNum">  170</span>              :  </span>
<span class="lineNum">  171</span><span class="lineCov">      1  /   1: 	panic_if(res &gt;= (int)sizeof(buf), </span>
<span class="lineNum">  172</span>              : 			&quot;Buffer overflow&quot;); </span>
<span class="lineNum">  173</span>              :  </span>
<span class="lineNum">  174</span><span class="lineCov">      1  /   1: 	return std::string(buf); </span>
<span class="lineNum">  175</span><span class="lineCov">      1  /   1: } </span>
<span class="lineNum">  176</span>              :  </span>
<span class="lineNum">  177</span>              :  </span>
<span class="lineNum">  178</span>              : int kcov_get_current_cpu(void) </span>
<span class="lineNum">  179</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  180</span><span class="lineNoCov">      0  /   1: 	return sched_getcpu(); </span>
<span class="lineNum">  181</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  182</span>              :  </span>
<span class="lineNum">  183</span>              : void kcov_tie_process_to_cpu(pid_t pid, int cpu) </span>
<span class="lineNum">  184</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  185</span>              : 	&#047;&#047; Switching CPU while running will cause icache </span>
<span class="lineNum">  186</span>              : 	&#047;&#047; conflicts. So let&#039;s just forbid that. </span>
<span class="lineNum">  187</span>              :  </span>
<span class="lineNum">  188</span><span class="lineNoCov">      0  /   1: 	cpu_set_t *set = CPU_ALLOC(1); </span>
<span class="lineNum">  189</span><span class="lineNoCov">      0  /   1: 	panic_if (!set, </span>
<span class="lineNum">  190</span>              : 			&quot;Can&#039;t allocate CPU set!&#092;n&quot;); </span>
<span class="lineNum">  191</span><span class="lineNoCov">      0  /   1: 	CPU_ZERO_S(CPU_ALLOC_SIZE(1), set); </span>
<span class="lineNum">  192</span><span class="lineNoCov">      0  /   1: 	CPU_SET(cpu, set); </span>
<span class="lineNum">  193</span><span class="lineNoCov">      0  /   1: 	panic_if (sched_setaffinity(pid, CPU_ALLOC_SIZE(1), set) &lt; 0, </span>
<span class="lineNum">  194</span>              : 			&quot;Can&#039;t set CPU affinity. Coincident won&#039;t work&quot;); </span>
<span class="lineNum">  195</span><span class="lineNoCov">      0  /   1: 	CPU_FREE(set); </span>
<span class="lineNum">  196</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  197</span>              :  </span>
<span class="lineNum">  198</span>              : void mdelay(unsigned int ms) </span>
<span class="lineNum">  199</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  200</span>              : 	struct timespec ts; </span>
<span class="lineNum">  201</span><span class="lineNoCov">      0  /   1: 	ts.tv_sec = 0; </span>
<span class="lineNum">  202</span><span class="lineNoCov">      0  /   1: 	ts.tv_nsec = ms * 1000 * 1000; </span>
<span class="lineNum">  203</span>              :  </span>
<span class="lineNum">  204</span><span class="lineNoCov">      0  /   1: 	nanosleep(&amp;ts, NULL); </span>
<span class="lineNum">  205</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  206</span>              :  </span>
<span class="lineNum">  207</span>              : uint64_t get_ms_timestamp(void) </span>
<span class="lineNum">  208</span><span class="lineCov">      1  /   1: { </span>
<span class="lineNum">  209</span><span class="lineCov">      1  /   1: 	return ((uint64_t)time(NULL)) * 1000; </span>
<span class="lineNum">  210</span><span class="lineCov">      1  /   1: } </span>
<span class="lineNum">  211</span>              :  </span>
<span class="lineNum">  212</span>              : bool machine_is_64bit(void) </span>
<span class="lineNum">  213</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  214</span><span class="lineNoCov">      0  /   1: 	return sizeof(unsigned long) == 8; </span>
<span class="lineNum">  215</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  216</span>              :  </span>
<span class="lineNum">  217</span>              :  </span>
<span class="lineNum">  218</span>              : &#047;&#047; http:&#047;&#047;stackoverflow.com&#047;questions&#047;236129&#047;how-to-split-a-string-in-c </span>
<span class="lineNum">  219</span>              : static std::list&lt;std::string&gt; &amp;split(const std::string &amp;s, char delim, </span>
<span class="lineNum">  220</span>              : 		std::list&lt;std::string&gt; &amp;elems) </span>
<span class="lineNum">  221</span><span class="lineCov">      1  /   1: { </span>
<span class="lineNum">  222</span><span class="lineCov">      1  /   1:     std::stringstream ss(s); </span>
<span class="lineNum">  223</span><span class="linePartCov">      2  /   3:     std::string item; </span>
<span class="lineNum">  224</span>              :  </span>
<span class="lineNum">  225</span><span class="lineCov">      2  /   2:     while (std::getline(ss, item, delim)) { </span>
<span class="lineNum">  226</span><span class="lineCov">      1  /   1:         elems.push_back(item); </span>
<span class="lineNum">  227</span>              :     } </span>
<span class="lineNum">  228</span>              :  </span>
<span class="lineNum">  229</span><span class="linePartCov">      2  /   3:     return elems; </span>
<span class="lineNum">  230</span><span class="lineCov">      1  /   1: } </span>
<span class="lineNum">  231</span>              :  </span>
<span class="lineNum">  232</span>              :  </span>
<span class="lineNum">  233</span>              : std::list&lt;std::string&gt; split_string(const std::string &amp;s, const char *delims) </span>
<span class="lineNum">  234</span><span class="lineCov">      1  /   1: { </span>
<span class="lineNum">  235</span><span class="lineCov">      1  /   1:     std::list&lt;std::string&gt; elems; </span>
<span class="lineNum">  236</span><span class="lineCov">      1  /   1:     split(s, *delims, elems); </span>
<span class="lineNum">  237</span>              :  </span>
<span class="lineNum">  238</span><span class="lineCov">      1  /   1:     return elems; </span>
<span class="lineNum">  239</span><span class="lineCov">      1  /   1: } </span>
<span class="lineNum">  240</span>              :  </span>
<span class="lineNum">  241</span>              : std::string trim_string(const std::string &amp;strIn) </span>
<span class="lineNum">  242</span><span class="lineCov">      1  /   1: { </span>
<span class="lineNum">  243</span><span class="lineCov">      1  /   1: 	std::string str = strIn; </span>
<span class="lineNum">  244</span><span class="lineCov">      1  /   1: 	size_t endpos = str.find_last_not_of(&quot; &#092;t&#092;n&#092;r&quot;); </span>
<span class="lineNum">  245</span>              :  </span>
<span class="lineNum">  246</span><span class="lineCov">      1  /   1: 	if (std::string::npos != endpos) </span>
<span class="lineNum">  247</span><span class="linePartCov">      1  /   2: 		str = str.substr( 0, endpos+1 ); </span>
<span class="lineNum">  248</span>              :  </span>
<span class="lineNum">  249</span>              : 	&#047;&#047; trim leading spaces </span>
<span class="lineNum">  250</span><span class="lineCov">      1  /   1: 	size_t startpos = str.find_first_not_of(&quot; &#092;t&quot;); </span>
<span class="lineNum">  251</span><span class="lineCov">      1  /   1: 	if (std::string::npos != startpos) </span>
<span class="lineNum">  252</span><span class="linePartCov">      1  /   2: 		str = str.substr( startpos ); </span>
<span class="lineNum">  253</span>              : 	else </span>
<span class="lineNum">  254</span><span class="lineCov">      1  /   1: 		str = &quot;&quot;; </span>
<span class="lineNum">  255</span>              :  </span>
<span class="lineNum">  256</span><span class="lineCov">      2  /   2: 	return str; </span>
<span class="lineNum">  257</span><span class="linePartCov">      1  /   2: } </span>
</pre>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
  <tr><td class="versionInfo">Generated by: <a href="http://simonkagstrom.github.com/kcov/index.html">Kcov</a></td></tr>
</table>
<br/>
</body>
</html>
