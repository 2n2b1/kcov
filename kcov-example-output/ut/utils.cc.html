<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Coverage - ut</title>
  <link rel="stylesheet" type="text/css" href="bcov.css"/>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr><td class="title">Coverage Report</td></tr>
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
  <tr>
    <td width="100%">
      <table cellpadding="1" border="0" width="100%">
        <tr>
          <td class="headerItem" width="20%">Command:</td>
          <td class="headerValue" width="80%" colspan=6>ut</td>
        </tr>
        <tr>
          <td class="headerItem" width="20%">Date:</td>
          <td class="headerValue" width="15%">2012-06-16 11:52:55</td>
          <td width="5%"></td>
          <td class="headerItem" width="20%">Instrumented&nbsp;lines:</td>
          <td class="headerValue" width="10%">97</td>
        </tr>
        <tr>
          <td class="headerItem" width="20%">Code&nbsp;covered:</td>
          <td class="coverPerLeftMed" width="15%">48.5%</td>
          <td width="5%"></td>
          <td class="headerItem" width="20%">Executed&nbsp;lines:</td>
          <td class="headerValue" width="10%">47</td>
        </tr>
      </table>
    </td>
  </tr>
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
</table>
<pre class="source">
<span class="lineNum">    1</span>              : #include &lt;sched.h&gt; </span>
<span class="lineNum">    2</span>              : #include &lt;sys&#047;types.h&gt; </span>
<span class="lineNum">    3</span>              : #include &lt;string.h&gt; </span>
<span class="lineNum">    4</span>              : #include &lt;stdio.h&gt; </span>
<span class="lineNum">    5</span>              : #include &lt;stdint.h&gt; </span>
<span class="lineNum">    6</span>              : #include &lt;sys&#047;types.h&gt; </span>
<span class="lineNum">    7</span>              : #include &lt;sys&#047;stat.h&gt; </span>
<span class="lineNum">    8</span>              : #include &lt;fcntl.h&gt; </span>
<span class="lineNum">    9</span>              : #include &lt;stdarg.h&gt; </span>
<span class="lineNum">   10</span>              : #include &lt;unistd.h&gt; </span>
<span class="lineNum">   11</span>              : #include &lt;libelf.h&gt; </span>
<span class="lineNum">   12</span>              :  </span>
<span class="lineNum">   13</span>              : #include &quot;utils.hh&quot; </span>
<span class="lineNum">   14</span>              :  </span>
<span class="lineNum">   15</span>              : int g_kcov_debug_mask; </span>
<span class="lineNum">   16</span>              :  </span>
<span class="lineNum">   17</span>              : extern int file_is_elf(const char *filename) </span>
<span class="lineNum">   18</span><span class="lineCov">      2  /   2: { </span>
<span class="lineNum">   19</span>              : 	Elf32_Ehdr hdr; </span>
<span class="lineNum">   20</span><span class="lineCov">      1  /   1: 	int ret = 0; </span>
<span class="lineNum">   21</span>              : 	int fd; </span>
<span class="lineNum">   22</span>              :  </span>
<span class="lineNum">   23</span><span class="lineCov">      1  /   1: 	fd = open(filename, O_RDONLY); </span>
<span class="lineNum">   24</span><span class="lineCov">      1  /   1: 	if (fd &lt; 0) </span>
<span class="lineNum">   25</span><span class="lineCov">      1  /   1: 		return ret; </span>
<span class="lineNum">   26</span>              :  </span>
<span class="lineNum">   27</span>              : 	&#047;* Compare the header with the ELF magic *&#047; </span>
<span class="lineNum">   28</span><span class="lineCov">      1  /   1: 	if (read(fd, &amp;hdr, sizeof(hdr)) == sizeof(hdr)) </span>
<span class="lineNum">   29</span><span class="lineCov">      1  /   1: 		ret = memcmp(hdr.e_ident, ELFMAG, strlen(ELFMAG)) == 0; </span>
<span class="lineNum">   30</span>              :  </span>
<span class="lineNum">   31</span><span class="lineCov">      1  /   1: 	close(fd); </span>
<span class="lineNum">   32</span>              :  </span>
<span class="lineNum">   33</span><span class="lineCov">      1  /   1: 	return ret; </span>
<span class="lineNum">   34</span><span class="lineCov">      1  /   1: } </span>
<span class="lineNum">   35</span>              :  </span>
<span class="lineNum">   36</span>              : void *read_file(size_t *out_size, const char *fmt, ...) </span>
<span class="lineNum">   37</span><span class="lineCov">      2  /   2: { </span>
<span class="lineNum">   38</span>              : 	struct stat buf; </span>
<span class="lineNum">   39</span>              : 	char path[2048]; </span>
<span class="lineNum">   40</span>              : 	va_list ap; </span>
<span class="lineNum">   41</span>              : 	void *data; </span>
<span class="lineNum">   42</span>              : 	size_t size; </span>
<span class="lineNum">   43</span>              : 	FILE *f; </span>
<span class="lineNum">   44</span>              : 	int r; </span>
<span class="lineNum">   45</span>              :  </span>
<span class="lineNum">   46</span>              : 	&#047;* Create the filename *&#047; </span>
<span class="lineNum">   47</span><span class="lineCov">      1  /   1: 	va_start(ap, fmt); </span>
<span class="lineNum">   48</span><span class="lineCov">      1  /   1: 	r = vsnprintf(path, 2048, fmt, ap); </span>
<span class="lineNum">   49</span>              : 	va_end(ap); </span>
<span class="lineNum">   50</span>              :  </span>
<span class="lineNum">   51</span><span class="lineCov">      1  /   1: 	panic_if (r &gt;= 2048, </span>
<span class="lineNum">   52</span>              : 			&quot;Too long string!&quot;); </span>
<span class="lineNum">   53</span>              :  </span>
<span class="lineNum">   54</span><span class="lineCov">      1  /   1: 	if (lstat(path, &amp;buf) &lt; 0) </span>
<span class="lineNum">   55</span><span class="lineNoCov">      0  /   1: 		return NULL; </span>
<span class="lineNum">   56</span>              :  </span>
<span class="lineNum">   57</span><span class="lineCov">      1  /   1: 	size = buf.st_size; </span>
<span class="lineNum">   58</span><span class="lineCov">      1  /   1: 	data = xmalloc(size + 2); &#047;* NULL-terminate, if used as string *&#047; </span>
<span class="lineNum">   59</span><span class="lineCov">      1  /   1: 	f = fopen(path, &quot;r&quot;); </span>
<span class="lineNum">   60</span><span class="lineCov">      1  /   1: 	if (!f) </span>
<span class="lineNum">   61</span>              : 	{ </span>
<span class="lineNum">   62</span><span class="lineNoCov">      0  /   1: 		free(data); </span>
<span class="lineNum">   63</span><span class="lineNoCov">      0  /   1: 		return NULL; </span>
<span class="lineNum">   64</span>              : 	} </span>
<span class="lineNum">   65</span><span class="lineCov">      1  /   1: 	if (fread(data, 1, size, f) != size) </span>
<span class="lineNum">   66</span>              : 	{ </span>
<span class="lineNum">   67</span><span class="lineNoCov">      0  /   1: 		free(data); </span>
<span class="lineNum">   68</span><span class="lineNoCov">      0  /   1: 		data = NULL; </span>
<span class="lineNum">   69</span>              : 	} </span>
<span class="lineNum">   70</span><span class="lineCov">      1  /   1: 	fclose(f); </span>
<span class="lineNum">   71</span>              :  </span>
<span class="lineNum">   72</span><span class="lineCov">      1  /   1: 	*out_size = size; </span>
<span class="lineNum">   73</span>              :  </span>
<span class="lineNum">   74</span><span class="lineCov">      1  /   1: 	return data; </span>
<span class="lineNum">   75</span><span class="lineCov">      1  /   1: } </span>
<span class="lineNum">   76</span>              :  </span>
<span class="lineNum">   77</span>              : int write_file(const void *data, size_t len, const char *fmt, ...) </span>
<span class="lineNum">   78</span><span class="lineCov">      2  /   2: { </span>
<span class="lineNum">   79</span>              : 	char path[2048]; </span>
<span class="lineNum">   80</span>              : 	va_list ap; </span>
<span class="lineNum">   81</span>              : 	FILE *fp; </span>
<span class="lineNum">   82</span><span class="lineCov">      1  /   1: 	int ret = 0; </span>
<span class="lineNum">   83</span>              :  </span>
<span class="lineNum">   84</span>              : 	&#047;* Create the filename *&#047; </span>
<span class="lineNum">   85</span><span class="lineCov">      1  /   1: 	va_start(ap, fmt); </span>
<span class="lineNum">   86</span><span class="lineCov">      1  /   1: 	vsnprintf(path, 2048, fmt, ap); </span>
<span class="lineNum">   87</span>              : 	va_end(ap); </span>
<span class="lineNum">   88</span>              :  </span>
<span class="lineNum">   89</span><span class="lineCov">      1  /   1: 	fp = fopen(path, &quot;w&quot;); </span>
<span class="lineNum">   90</span><span class="lineCov">      1  /   1: 	if (!fp) </span>
<span class="lineNum">   91</span><span class="lineNoCov">      0  /   1: 		return -1; </span>
<span class="lineNum">   92</span>              :  </span>
<span class="lineNum">   93</span><span class="lineCov">      1  /   1: 	if (fwrite(data, sizeof(uint8_t), len, fp) != len) </span>
<span class="lineNum">   94</span><span class="lineNoCov">      0  /   1: 		ret = -1; </span>
<span class="lineNum">   95</span><span class="lineCov">      1  /   1: 	fclose(fp); </span>
<span class="lineNum">   96</span>              :  </span>
<span class="lineNum">   97</span><span class="lineCov">      1  /   1: 	return ret; </span>
<span class="lineNum">   98</span><span class="lineCov">      1  /   1: } </span>
<span class="lineNum">   99</span>              :  </span>
<span class="lineNum">  100</span>              : const char *dir_concat(const char *dir, const char *filename) </span>
<span class="lineNum">  101</span><span class="lineCov">      1  /   1: { </span>
<span class="lineNum">  102</span>              : 	size_t len; </span>
<span class="lineNum">  103</span>              : 	char *out; </span>
<span class="lineNum">  104</span>              :  </span>
<span class="lineNum">  105</span><span class="lineCov">      1  /   1: 	if (dir == NULL) </span>
<span class="lineNum">  106</span><span class="lineCov">      1  /   1: 		return xstrdup(filename); </span>
<span class="lineNum">  107</span>              :  </span>
<span class="lineNum">  108</span><span class="lineNoCov">      0  /   1: 	len = strlen(dir) + strlen(filename) + 4; </span>
<span class="lineNum">  109</span><span class="lineNoCov">      0  /   1: 	out = (char *)xmalloc(len); </span>
<span class="lineNum">  110</span>              :  </span>
<span class="lineNum">  111</span><span class="lineNoCov">      0  /   1: 	xsnprintf(out, len, &quot;%s&#047;%s&quot;, dir, filename); </span>
<span class="lineNum">  112</span>              :  </span>
<span class="lineNum">  113</span><span class="lineNoCov">      0  /   1: 	return out; </span>
<span class="lineNum">  114</span><span class="lineCov">      1  /   1: } </span>
<span class="lineNum">  115</span>              :  </span>
<span class="lineNum">  116</span>              : const char *expand_path(const char *path) </span>
<span class="lineNum">  117</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  118</span><span class="lineNoCov">      0  /   1: 	size_t p_len = strlen(path); </span>
<span class="lineNum">  119</span><span class="lineNoCov">      0  /   1: 	const char *home = getenv(&quot;HOME&quot;); </span>
<span class="lineNum">  120</span>              : 	size_t home_len; </span>
<span class="lineNum">  121</span>              : 	char *out; </span>
<span class="lineNum">  122</span>              :  </span>
<span class="lineNum">  123</span><span class="lineNoCov">      0  /   1: 	if (!home || p_len &lt; 1 || path[0] != &#039;~&#039;) </span>
<span class="lineNum">  124</span><span class="lineNoCov">      0  /   1: 		return xstrdup(path); </span>
<span class="lineNum">  125</span>              :  </span>
<span class="lineNum">  126</span><span class="lineNoCov">      0  /   1: 	home_len = strlen(home); </span>
<span class="lineNum">  127</span><span class="lineNoCov">      0  /   1: 	out = (char *)xmalloc(home_len + p_len + 8); </span>
<span class="lineNum">  128</span><span class="lineNoCov">      0  /   1: 	snprintf(out, home_len + p_len + 8, &quot;%s&#047;%s&quot;, home, path + 1); </span>
<span class="lineNum">  129</span>              :  </span>
<span class="lineNum">  130</span><span class="lineNoCov">      0  /   1: 	return out; </span>
<span class="lineNum">  131</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  132</span>              :  </span>
<span class="lineNum">  133</span>              :  </span>
<span class="lineNum">  134</span>              : int file_exists(const char *path) </span>
<span class="lineNum">  135</span><span class="lineCov">      1  /   1: { </span>
<span class="lineNum">  136</span>              : 	struct stat st; </span>
<span class="lineNum">  137</span>              :  </span>
<span class="lineNum">  138</span><span class="lineCov">      1  /   1: 	return lstat(path, &amp;st) == 0; </span>
<span class="lineNum">  139</span><span class="lineCov">      1  /   1: } </span>
<span class="lineNum">  140</span>              :  </span>
<span class="lineNum">  141</span>              : static void read_write(FILE *dst, FILE *src) </span>
<span class="lineNum">  142</span><span class="lineNoCov">      0  /   2: { </span>
<span class="lineNum">  143</span>              : 	char buf[1024]; </span>
<span class="lineNum">  144</span>              :  </span>
<span class="lineNum">  145</span><span class="lineNoCov">      0  /   2: 	while (!feof(src)) { </span>
<span class="lineNum">  146</span><span class="lineNoCov">      0  /   1: 		int n = fread(buf, sizeof(char), sizeof(buf), src); </span>
<span class="lineNum">  147</span>              :  </span>
<span class="lineNum">  148</span><span class="lineNoCov">      0  /   1: 		fwrite(buf, sizeof(char), n, dst); </span>
<span class="lineNum">  149</span>              : 	} </span>
<span class="lineNum">  150</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  151</span>              :  </span>
<span class="lineNum">  152</span>              : int concat_files(const char *dst_name, const char *file_a, const char *file_b) </span>
<span class="lineNum">  153</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  154</span>              : 	FILE *dst; </span>
<span class="lineNum">  155</span>              : 	FILE *s1, *s2; </span>
<span class="lineNum">  156</span><span class="lineNoCov">      0  /   1: 	int ret = -1; </span>
<span class="lineNum">  157</span>              :  </span>
<span class="lineNum">  158</span><span class="lineNoCov">      0  /   1: 	dst = fopen(dst_name, &quot;w&quot;); </span>
<span class="lineNum">  159</span><span class="lineNoCov">      0  /   1: 	if (!dst) </span>
<span class="lineNum">  160</span><span class="lineNoCov">      0  /   1: 		return -1; </span>
<span class="lineNum">  161</span><span class="lineNoCov">      0  /   1: 	s1 = fopen(file_a, &quot;r&quot;); </span>
<span class="lineNum">  162</span><span class="lineNoCov">      0  /   1: 	if (!s1) </span>
<span class="lineNum">  163</span><span class="lineNoCov">      0  /   1: 		goto out_dst; </span>
<span class="lineNum">  164</span><span class="lineNoCov">      0  /   1: 	s2 = fopen(file_b, &quot;r&quot;); </span>
<span class="lineNum">  165</span><span class="lineNoCov">      0  /   1: 	if (!s2) </span>
<span class="lineNum">  166</span><span class="lineNoCov">      0  /   1: 		goto out_s1; </span>
<span class="lineNum">  167</span>              :  </span>
<span class="lineNum">  168</span><span class="lineNoCov">      0  /   1: 	read_write(dst, s1); </span>
<span class="lineNum">  169</span><span class="lineNoCov">      0  /   1: 	read_write(dst, s2); </span>
<span class="lineNum">  170</span>              :  </span>
<span class="lineNum">  171</span><span class="lineNoCov">      0  /   1: 	fclose(s2); </span>
<span class="lineNum">  172</span>              : out_s1: </span>
<span class="lineNum">  173</span><span class="lineNoCov">      0  /   1: 	fclose(s1); </span>
<span class="lineNum">  174</span>              : out_dst: </span>
<span class="lineNum">  175</span><span class="lineNoCov">      0  /   1: 	fclose(dst); </span>
<span class="lineNum">  176</span>              :  </span>
<span class="lineNum">  177</span><span class="lineNoCov">      0  /   1: 	return ret; </span>
<span class="lineNum">  178</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  179</span>              :  </span>
<span class="lineNum">  180</span>              : unsigned long get_aligned(unsigned long addr) </span>
<span class="lineNum">  181</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  182</span><span class="lineNoCov">      0  /   1: 	return (addr &#047; sizeof(long)) * sizeof(long); </span>
<span class="lineNum">  183</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  184</span>              :  </span>
<span class="lineNum">  185</span>              : unsigned long get_aligned_4b(unsigned long addr) </span>
<span class="lineNum">  186</span><span class="lineNoCov">      0  /   1: { </span>
<span class="lineNum">  187</span><span class="lineNoCov">      0  /   1: 	return addr &amp; ~3; </span>
<span class="lineNum">  188</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">  189</span>              :  </span>
<span class="lineNum">  190</span>              : std::string fmt(const char *fmt, ...) </span>
<span class="lineNum">  191</span><span class="lineCov">      2  /   2: { </span>
<span class="lineNum">  192</span>              : 	char buf[4096]; </span>
<span class="lineNum">  193</span>              : 	va_list ap; </span>
<span class="lineNum">  194</span>              : 	int res; </span>
<span class="lineNum">  195</span>              :  </span>
<span class="lineNum">  196</span><span class="lineCov">      1  /   1: 	va_start(ap, fmt); </span>
<span class="lineNum">  197</span><span class="lineCov">      1  /   1: 	res = vsnprintf(buf, sizeof(buf), fmt, ap); </span>
<span class="lineNum">  198</span>              : 	va_end(ap); </span>
<span class="lineNum">  199</span>              :  </span>
<span class="lineNum">  200</span><span class="lineCov">      1  /   1: 	panic_if(res &gt;= (int)sizeof(buf), </span>
<span class="lineNum">  201</span>              : 			&quot;Buffer overflow&quot;); </span>
<span class="lineNum">  202</span>              :  </span>
<span class="lineNum">  203</span><span class="linePartCov">      1  /   2: 	return std::string(buf); </span>
<span class="lineNum">  204</span><span class="linePartCov">      1  /   3: } </span>
</pre>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
  <tr><td class="versionInfo">Generated by: <a href="http://simonkagstrom.github.com/kcov/index.html">Kcov</a> (based on <a href="http://bcov.sourceforge.net">bcov</a>)</td></tr>
</table>
<br/>
</body>
</html>
