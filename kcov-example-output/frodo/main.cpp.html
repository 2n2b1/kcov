<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Coverage - frodo</title>
  <link rel="stylesheet" type="text/css" href="bcov.css"/>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr><td class="title">Coverage Report</td></tr>
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
  <tr>
    <td width="100%">
      <table cellpadding="1" border="0" width="100%">
        <tr>
          <td class="headerItem" width="20%">Command:</td>
          <td class="headerValue" width="80%" colspan=6>frodo</td>
        </tr>
        <tr>
          <td class="headerItem" width="20%">Date:</td>
          <td class="headerValue" width="15%">2012-06-16 11:50:06</td>
          <td width="5%"></td>
          <td class="headerItem" width="20%">Instrumented&nbsp;lines:</td>
          <td class="headerValue" width="10%">70</td>
        </tr>
        <tr>
          <td class="headerItem" width="20%">Code&nbsp;covered:</td>
          <td class="coverPerLeftHi" width="15%">90.0%</td>
          <td width="5%"></td>
          <td class="headerItem" width="20%">Executed&nbsp;lines:</td>
          <td class="headerValue" width="10%">63</td>
        </tr>
      </table>
    </td>
  </tr>
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
</table>
<pre class="source">
<span class="lineNum">    1</span>              : &#047;*  </span>
<span class="lineNum">    2</span>              :  *  main.cpp - Main program  </span>
<span class="lineNum">    3</span>              :  *  </span>
<span class="lineNum">    4</span>              :  *  Frodo (C) 1994-1997,2002-2005 Christian Bauer  </span>
<span class="lineNum">    5</span>              :  *  </span>
<span class="lineNum">    6</span>              :  *  This program is free software; you can redistribute it and&#047;or modify  </span>
<span class="lineNum">    7</span>              :  *  it under the terms of the GNU General Public License as published by  </span>
<span class="lineNum">    8</span>              :  *  the Free Software Foundation; either version 2 of the License, or  </span>
<span class="lineNum">    9</span>              :  *  (at your option) any later version.  </span>
<span class="lineNum">   10</span>              :  *  </span>
<span class="lineNum">   11</span>              :  *  This program is distributed in the hope that it will be useful,  </span>
<span class="lineNum">   12</span>              :  *  but WITHOUT ANY WARRANTY; without even the implied warranty of  </span>
<span class="lineNum">   13</span>              :  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  </span>
<span class="lineNum">   14</span>              :  *  GNU General Public License for more details.  </span>
<span class="lineNum">   15</span>              :  *  </span>
<span class="lineNum">   16</span>              :  *  You should have received a copy of the GNU General Public License  </span>
<span class="lineNum">   17</span>              :  *  along with this program; if not, write to the Free Software  </span>
<span class="lineNum">   18</span>              :  *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA  </span>
<span class="lineNum">   19</span>              :  *&#047;  </span>
<span class="lineNum">   20</span>              : #include &lt;SDL.h&gt;  </span>
<span class="lineNum">   21</span>              : #include &lt;SDL_ttf.h&gt;  </span>
<span class="lineNum">   22</span>              :   </span>
<span class="lineNum">   23</span>              : #include &quot;sysdeps.h&quot;  </span>
<span class="lineNum">   24</span>              :   </span>
<span class="lineNum">   25</span>              : #include &quot;main.h&quot;  </span>
<span class="lineNum">   26</span>              : #include &quot;C64.h&quot;  </span>
<span class="lineNum">   27</span>              : #include &quot;Display.h&quot;  </span>
<span class="lineNum">   28</span>              : #include &quot;Prefs.h&quot;  </span>
<span class="lineNum">   29</span>              : #include &quot;SAM.h&quot;  </span>
<span class="lineNum">   30</span>              : #include &quot;gui&#047;gui.hh&quot;  </span>
<span class="lineNum">   31</span>              : #include &quot;data_store.hh&quot;  </span>
<span class="lineNum">   32</span>              : #include &quot;utils.hh&quot;  </span>
<span class="lineNum">   33</span>              :   </span>
<span class="lineNum">   34</span>              : #if defined(GEKKO)  </span>
<span class="lineNum">   35</span>              : #include &lt;fat.h&gt;  </span>
<span class="lineNum">   36</span>              : #endif  </span>
<span class="lineNum">   37</span>              :   </span>
<span class="lineNum">   38</span>              :   </span>
<span class="lineNum">   39</span>              : &#047;&#047; Global variables  </span>
<span class="lineNum">   40</span>              : extern int init_graphics(void);  </span>
<span class="lineNum">   41</span>              :   </span>
<span class="lineNum">   42</span>              :   </span>
<span class="lineNum">   43</span>              : &#047;&#047; Global variables  </span>
<span class="lineNum">   44</span>              : C64 *TheC64 = NULL;		&#047;&#047; Global C64 object  </span>
<span class="lineNum">   45</span>              : char AppDirPath[1024];	&#047;&#047; Path of application directory  </span>
<span class="lineNum">   46</span>              :   </span>
<span class="lineNum">   47</span>              :   </span>
<span class="lineNum">   48</span>              : &#047;&#047; ROM file names  </span>
<span class="lineNum">   49</span>              : #ifndef DATADIR  </span>
<span class="lineNum">   50</span>              : #define DATADIR  </span>
<span class="lineNum">   51</span>              : #endif  </span>
<span class="lineNum">   52</span>              :   </span>
<span class="lineNum">   53</span>              : #ifdef __riscos__  </span>
<span class="lineNum">   54</span>              : #define BASIC_ROM_FILE	&quot;FrodoRsrc:Basic_ROM&quot;  </span>
<span class="lineNum">   55</span>              : #define KERNAL_ROM_FILE	&quot;FrodoRsrc:Kernal_ROM&quot;  </span>
<span class="lineNum">   56</span>              : #define CHAR_ROM_FILE	&quot;FrodoRsrc:Char_ROM&quot;  </span>
<span class="lineNum">   57</span>              : #define DRIVE_ROM_FILE	&quot;FrodoRsrc:1541_ROM&quot;  </span>
<span class="lineNum">   58</span>              : #elif GEKKO  </span>
<span class="lineNum">   59</span>              : #define WII_FRODO_BASE_PATH &quot;&#047;apps&#047;frodo&#047;&quot;  </span>
<span class="lineNum">   60</span>              : #define BASIC_ROM_FILE	WII_FRODO_BASE_PATH&quot;Basic_ROM&quot;  </span>
<span class="lineNum">   61</span>              : #define KERNAL_ROM_FILE	WII_FRODO_BASE_PATH&quot;Kernal_ROM&quot;  </span>
<span class="lineNum">   62</span>              : #define CHAR_ROM_FILE	WII_FRODO_BASE_PATH&quot;Char_ROM&quot;  </span>
<span class="lineNum">   63</span>              : #define DRIVE_ROM_FILE	WII_FRODO_BASE_PATH&quot;1541_ROM&quot;  </span>
<span class="lineNum">   64</span>              : #else  </span>
<span class="lineNum">   65</span>              : #define BASIC_ROM_FILE DATADIR &quot;Basic ROM&quot;  </span>
<span class="lineNum">   66</span>              : #define KERNAL_ROM_FILE DATADIR &quot;Kernal ROM&quot;  </span>
<span class="lineNum">   67</span>              : #define CHAR_ROM_FILE DATADIR &quot;Char ROM&quot;  </span>
<span class="lineNum">   68</span>              : #define DRIVE_ROM_FILE DATADIR &quot;1541 ROM&quot;  </span>
<span class="lineNum">   69</span>              : #endif  </span>
<span class="lineNum">   70</span>              :   </span>
<span class="lineNum">   71</span>              :   </span>
<span class="lineNum">   72</span>              : &#047;&#047; Builtin ROMs  </span>
<span class="lineNum">   73</span>              : #include &quot;Basic_ROM.h&quot;  </span>
<span class="lineNum">   74</span>              : #include &quot;Kernal_ROM.h&quot;  </span>
<span class="lineNum">   75</span>              : #include &quot;Char_ROM.h&quot;  </span>
<span class="lineNum">   76</span>              : #include &quot;1541_ROM.h&quot;  </span>
<span class="lineNum">   77</span>              :   </span>
<span class="lineNum">   78</span>              :   </span>
<span class="lineNum">   79</span>              : &#047;*  </span>
<span class="lineNum">   80</span>              :  *  Load C64 ROM files  </span>
<span class="lineNum">   81</span>              :  *&#047;  </span>
<span class="lineNum">   82</span>              :   </span>
<span class="lineNum">   83</span>              : void Frodo::load_rom(const char *which, const char *path, uint8 *where, size_t size, const uint8 *builtin)  </span>
<span class="lineNum">   84</span><span class="lineCov">      3  /   3: {  </span>
<span class="lineNum">   85</span>              : 	FILE *f = fopen(path, &quot;rb&quot;);  </span>
<span class="lineNum">   86</span>              : 	if (f) {  </span>
<span class="lineNum">   87</span>              : 		size_t actual = fread(where, 1, size, f);  </span>
<span class="lineNum">   88</span><span class="lineCov">      3  /   3: 		fclose(f);  </span>
<span class="lineNum">   89</span>              : 		if (actual == size)  </span>
<span class="lineNum">   90</span>              : 			return;  </span>
<span class="lineNum">   91</span><span class="lineCov">      2  /   2: 	}  </span>
<span class="lineNum">   92</span><span class="lineCov">      2  /   2:   </span>
<span class="lineNum">   93</span><span class="lineCov">      1  /   1: 	&#047;&#047; Use builtin ROM  </span>
<span class="lineNum">   94</span><span class="lineCov">      1  /   1: 	printf(&quot;%s ROM file (%s) not readable, using builtin.&#092;n&quot;, which, path);  </span>
<span class="lineNum">   95</span><span class="lineCov">      1  /   1: 	memcpy(where, builtin, size);  </span>
<span class="lineNum">   96</span><span class="lineCov">      1  /   1: }  </span>
<span class="lineNum">   97</span>              :   </span>
<span class="lineNum">   98</span>              : void Frodo::load_rom_files()  </span>
<span class="lineNum">   99</span>              : {  </span>
<span class="lineNum">  100</span>              : 	load_rom(&quot;Basic&quot;, BASIC_ROM_FILE, TheC64-&gt;Basic, BASIC_ROM_SIZE, builtin_basic_rom);  </span>
<span class="lineNum">  101</span>              : 	load_rom(&quot;Kernal&quot;, KERNAL_ROM_FILE, TheC64-&gt;Kernal, KERNAL_ROM_SIZE, builtin_kernal_rom);  </span>
<span class="lineNum">  102</span>              : 	load_rom(&quot;Char&quot;, CHAR_ROM_FILE, TheC64-&gt;Char, CHAR_ROM_SIZE, builtin_char_rom);  </span>
<span class="lineNum">  103</span><span class="lineCov">      1  /   1: 	load_rom(&quot;1541&quot;, DRIVE_ROM_FILE, TheC64-&gt;ROM1541, DRIVE_ROM_SIZE, builtin_drive_rom);  </span>
<span class="lineNum">  104</span>              : }  </span>
<span class="lineNum">  105</span><span class="lineCov">      1  /   1:   </span>
<span class="lineNum">  106</span><span class="lineCov">      1  /   1: &#047;*  </span>
<span class="lineNum">  107</span>              :  *  Create application object and start it  </span>
<span class="lineNum">  108</span>              :  *&#047;  </span>
<span class="lineNum">  109</span>              :   </span>
<span class="lineNum">  110</span>              : extern &quot;C&quot; int main(int argc, char **argv)  </span>
<span class="lineNum">  111</span>              : {  </span>
<span class="lineNum">  112</span><span class="lineCov">      1  /   1: 	timeval tv;  </span>
<span class="lineNum">  113</span><span class="lineNoCov">      0  /   1: 	gettimeofday(&amp;tv, NULL);  </span>
<span class="lineNum">  114</span>              : 	srand(tv.tv_usec);  </span>
<span class="lineNum">  115</span>              : #if defined(GEKKO)  </span>
<span class="lineNum">  116</span><span class="lineCov">      1  /   1: 	DIR_ITER *dir_tmp;  </span>
<span class="lineNum">  117</span>              : #endif  </span>
<span class="lineNum">  118</span><span class="lineNoCov">      0  /   1:   </span>
<span class="lineNum">  119</span><span class="lineNoCov">      0  /   1: 	&#047;&#047; Init SDL  </span>
<span class="lineNum">  120</span>              :         if (SDL_Init(SDL_INIT_VIDEO | SDL_INIT_AUDIO | SDL_INIT_TIMER | SDL_INIT_JOYSTICK) &lt; 0) {  </span>
<span class="lineNum">  121</span>              :                 LOG(&quot;Couldn&#039;t initialize SDL (%s)&#092;n&quot;, SDL_GetError());  </span>
<span class="lineNum">  122</span><span class="lineCov">      1  /   1:                 return 1;  </span>
<span class="lineNum">  123</span>              : 	}  </span>
<span class="lineNum">  124</span>              :         if (TTF_Init() &lt; 0)  </span>
<span class="lineNum">  125</span>              :         {  </span>
<span class="lineNum">  126</span>              :                 LOG(&quot;Unable to init TTF: %s&#092;n&quot;, TTF_GetError());  </span>
<span class="lineNum">  127</span>              : 		return 1;  </span>
<span class="lineNum">  128</span>              :         }  </span>
<span class="lineNum">  129</span>              :   </span>
<span class="lineNum">  130</span>              : 	fflush(stdout);  </span>
<span class="lineNum">  131</span>              :   </span>
<span class="lineNum">  132</span>              : 	#ifdef GEKKO  </span>
<span class="lineNum">  133</span>              : 	  </span>
<span class="lineNum">  134</span>              : 	printf(&quot;&#092;x1b[2;0H&quot;);  </span>
<span class="lineNum">  135</span>              :   </span>
<span class="lineNum">  136</span>              : 	&#047;&#047;initialize libfat library  </span>
<span class="lineNum">  137</span>              : 	if (!fatInitDefault())  </span>
<span class="lineNum">  138</span>              : 	{   </span>
<span class="lineNum">  139</span>              : 	printf(&quot;Couldn&#039;t initialize fat subsytem&#092;n&quot;);  </span>
<span class="lineNum">  140</span>              : 	sleep(3);  </span>
<span class="lineNum">  141</span>              : 	exit(0);  </span>
<span class="lineNum">  142</span>              : 	}  </span>
<span class="lineNum">  143</span><span class="lineCov">      1  /   1: 	  </span>
<span class="lineNum">  144</span>              : 	&#047;&#047;create tmp directory if it does not exist  </span>
<span class="lineNum">  145</span><span class="lineCov">      1  /   1: 	dir_tmp = diropen(&quot;&#047;frodo&#047;tmp&quot;);	  </span>
<span class="lineNum">  146</span><span class="lineCov">      1  /   1: 	if (!dir_tmp) {mkdir(&quot;&#047;frodo&#047;tmp&quot;,0777);printf(&quot;Making tmp directory&#092;n&quot;);sleep(3);} else dirclose(dir_tmp);  </span>
<span class="lineNum">  147</span>              : 	  </span>
<span class="lineNum">  148</span>              : 	  </span>
<span class="lineNum">  149</span>              : 	#endif  </span>
<span class="lineNum">  150</span>              :   </span>
<span class="lineNum">  151</span>              : 	Frodo *the_app = new Frodo();  </span>
<span class="lineNum">  152</span><span class="lineCov">      1  /   1: 	the_app-&gt;ArgvReceived(argc, argv);  </span>
<span class="lineNum">  153</span><span class="linePartCov">      2  /   4: 	the_app-&gt;ReadyToRun();  </span>
<span class="lineNum">  154</span>              : 	delete the_app;  </span>
<span class="lineNum">  155</span>              :   </span>
<span class="lineNum">  156</span>              : 	#ifdef GEKKO  </span>
<span class="lineNum">  157</span>              : 	fatUnmount(0);  </span>
<span class="lineNum">  158</span>              : 	#endif  </span>
<span class="lineNum">  159</span>              :   </span>
<span class="lineNum">  160</span><span class="lineCov">      3  /   3: 	return 0;  </span>
<span class="lineNum">  161</span>              : }  </span>
<span class="lineNum">  162</span><span class="lineCov">      2  /   2:   </span>
<span class="lineNum">  163</span>              :   </span>
<span class="lineNum">  164</span><span class="lineCov">      1  /   1: &#047;*  </span>
<span class="lineNum">  165</span><span class="lineCov">      6  /   6:  *  Constructor: Initialize member variables  </span>
<span class="lineNum">  166</span><span class="lineCov">      5  /   5:  *&#047;  </span>
<span class="lineNum">  167</span><span class="lineCov">      2  /   2:   </span>
<span class="lineNum">  168</span>              : Frodo::Frodo()  </span>
<span class="lineNum">  169</span>              : {  </span>
<span class="lineNum">  170</span>              : 	Prefs p;  </span>
<span class="lineNum">  171</span>              :   </span>
<span class="lineNum">  172</span>              : 	TheC64 = NULL;  </span>
<span class="lineNum">  173</span>              : 	ThePrefs = p; &#047;* Silly workaround to fix joystick bug *&#047;  </span>
<span class="lineNum">  174</span>              : 	TheDefaultPrefs = p;  </span>
<span class="lineNum">  175</span>              : }  </span>
<span class="lineNum">  176</span><span class="lineNoCov">      0  /   1:   </span>
<span class="lineNum">  177</span><span class="linePartCov">      1  /   2:   </span>
<span class="lineNum">  178</span><span class="lineNoCov">      0  /   3: &#047;*  </span>
<span class="lineNum">  179</span><span class="lineNoCov">      0  /   3:  *  Process command line arguments  </span>
<span class="lineNum">  180</span>              :  *&#047;  </span>
<span class="lineNum">  181</span>              : char *network_server_connect = 0;  </span>
<span class="lineNum">  182</span><span class="lineCov">      1  /   1:   </span>
<span class="lineNum">  183</span><span class="lineCov">      2  /   2: void Frodo::ArgvReceived(int argc, char **argv)  </span>
<span class="lineNum">  184</span><span class="lineNoCov">      0  /   1: {  </span>
<span class="lineNum">  185</span>              : 	if (argc == 2)  </span>
<span class="lineNum">  186</span><span class="lineCov">      1  /   1: 		network_server_connect = argv[1];  </span>
<span class="lineNum">  187</span>              : }  </span>
<span class="lineNum">  188</span><span class="lineCov">      1  /   1:   </span>
<span class="lineNum">  189</span>              : const char *try_path(const char *path, const char *file)  </span>
<span class="lineNum">  190</span>              : {  </span>
<span class="lineNum">  191</span><span class="lineCov">      2  /   2: 	if (path == NULL || file == NULL)  </span>
<span class="lineNum">  192</span>              : 		return NULL;  </span>
<span class="lineNum">  193</span>              :   </span>
<span class="lineNum">  194</span>              : 	char *what = (char *)xmalloc(strlen(path) + strlen(file) + 3);  </span>
<span class="lineNum">  195</span><span class="linePartCov">      2  /   4: 	struct stat st;  </span>
<span class="lineNum">  196</span>              : 	const char *out = NULL;  </span>
<span class="lineNum">  197</span>              :   </span>
<span class="lineNum">  198</span><span class="lineCov">      2  /   2: 	sprintf(what, &quot;%s&#047;%s&quot;, path, file);  </span>
<span class="lineNum">  199</span>              : 	if (stat(what, &amp;st) == 0)  </span>
<span class="lineNum">  200</span>              : 		out = what;  </span>
<span class="lineNum">  201</span>              :   </span>
<span class="lineNum">  202</span>              : 	return out;  </span>
<span class="lineNum">  203</span>              : }  </span>
<span class="lineNum">  204</span>              :   </span>
<span class="lineNum">  205</span>              : void Frodo::LoadFrodorc()  </span>
<span class="lineNum">  206</span>              : {  </span>
<span class="lineNum">  207</span>              : 	const char *paths[] = {  </span>
<span class="lineNum">  208</span><span class="lineCov">      1  /   1: 			&quot;&#047;frodo&quot;, &#047;&#047; Wii  </span>
<span class="lineNum">  209</span>              : 			&quot;.&quot;,  </span>
<span class="lineNum">  210</span>              : 			&quot;&#047;apps&#047;frodo&quot;, &#047;&#047; Wii  </span>
<span class="lineNum">  211</span>              : 			&quot;frodo&quot;,  </span>
<span class="lineNum">  212</span>              : 			NULL, &#047;&#047; Filled in below  </span>
<span class="lineNum">  213</span>              : 			NULL, &#047;&#047; also filled in below  </span>
<span class="lineNum">  214</span>              : 			&quot;&#047;usr&#047;share&#047;frodo&quot;,  </span>
<span class="lineNum">  215</span>              : 			NULL,  </span>
<span class="lineNum">  216</span><span class="lineCov">      2  /   2: 	};  </span>
<span class="lineNum">  217</span>              : 	const char *prefs_path = NULL;  </span>
<span class="lineNum">  218</span><span class="lineCov">      2  /   2: 	const char *prefs_name = NULL;  </span>
<span class="lineNum">  219</span><span class="lineCov">      3  /   3: 	const char *total_name = NULL;  </span>
<span class="lineNum">  220</span>              : 	char home_1[255];  </span>
<span class="lineNum">  221</span>              : 	char home_2[255];  </span>
<span class="lineNum">  222</span>              : 	int i;  </span>
<span class="lineNum">  223</span>              :   </span>
<span class="lineNum">  224</span>              : 	if (getenv(&quot;HOME&quot;))  </span>
<span class="lineNum">  225</span>              : 	{  </span>
<span class="lineNum">  226</span><span class="lineCov">      1  /   1: 		snprintf(home_1, sizeof(home_1), &quot;%s&#047;.frodo&quot;, getenv(&quot;HOME&quot;));  </span>
<span class="lineNum">  227</span><span class="lineCov">      2  /   2: 		snprintf(home_2, sizeof(home_2), &quot;%s&#047;frodo&quot;, getenv(&quot;HOME&quot;));  </span>
<span class="lineNum">  228</span>              : 	}  </span>
<span class="lineNum">  229</span><span class="lineCov">      2  /   2: 	else  </span>
<span class="lineNum">  230</span>              : 	{  </span>
<span class="lineNum">  231</span>              : 		strcpy(home_1, &quot;&quot;);  </span>
<span class="lineNum">  232</span>              : 		strcpy(home_2, &quot;&quot;);  </span>
<span class="lineNum">  233</span>              : 	}  </span>
<span class="lineNum">  234</span><span class="lineCov">      2  /   2: 	paths[4] = home_1;  </span>
<span class="lineNum">  235</span>              : 	paths[5] = home_2;  </span>
<span class="lineNum">  236</span><span class="lineCov">      2  /   2:   </span>
<span class="lineNum">  237</span>              : 	for (i = 0; paths[i]; i++)  </span>
<span class="lineNum">  238</span>              : 	{  </span>
<span class="lineNum">  239</span>              : 		const char *p;  </span>
<span class="lineNum">  240</span>              : 		const char *name = &quot;frodorc&quot;;  </span>
<span class="lineNum">  241</span>              :   </span>
<span class="lineNum">  242</span>              : 		p = try_path(paths[i], name);  </span>
<span class="lineNum">  243</span><span class="lineCov">      1  /   1:   </span>
<span class="lineNum">  244</span>              : 		if (p)  </span>
<span class="lineNum">  245</span>              : 		{  </span>
<span class="lineNum">  246</span>              : 			prefs_path = paths[i];  </span>
<span class="lineNum">  247</span>              : 			prefs_name = name;  </span>
<span class="lineNum">  248</span>              : 			total_name = p;  </span>
<span class="lineNum">  249</span><span class="lineCov">      1  /   1: 			break;  </span>
<span class="lineNum">  250</span>              : 		}  </span>
<span class="lineNum">  251</span>              : 		free((void*)p);  </span>
<span class="lineNum">  252</span>              : 	}  </span>
<span class="lineNum">  253</span>              :   </span>
<span class="lineNum">  254</span><span class="lineCov">      1  /   1: 	&#047;&#047; Load preferences  </span>
<span class="lineNum">  255</span><span class="linePartCov">      1  /   2: 	if (total_name)  </span>
<span class="lineNum">  256</span>              : 	{  </span>
<span class="lineNum">  257</span>              : 		ThePrefs.Load(total_name);  </span>
<span class="lineNum">  258</span>              : 		strncpy(ThePrefs.PrefsPath, total_name, sizeof(ThePrefs.PrefsPath));  </span>
<span class="lineNum">  259</span>              : 	} else  </span>
<span class="lineNum">  260</span>              : 		printf(&quot;No frodorc, using default&#092;n&quot;);  </span>
<span class="lineNum">  261</span>              :   </span>
<span class="lineNum">  262</span><span class="lineCov">      2  /   2: 	free((void*)total_name);  </span>
<span class="lineNum">  263</span><span class="lineCov">      1  /   1: }  </span>
<span class="lineNum">  264</span>              :   </span>
<span class="lineNum">  265</span>              : &#047;*  </span>
<span class="lineNum">  266</span><span class="lineCov">      1  /   1:  *  Arguments processed, run emulation  </span>
<span class="lineNum">  267</span><span class="lineCov">      1  /   1:  *&#047;  </span>
<span class="lineNum">  268</span>              :   </span>
<span class="lineNum">  269</span>              : void Frodo::ReadyToRun(void)  </span>
<span class="lineNum">  270</span><span class="linePartCov">      1  /   2: {  </span>
<span class="lineNum">  271</span>              : 	if (getcwd(AppDirPath, 256) == NULL)  </span>
<span class="lineNum">  272</span>              : 		strcpy(AppDirPath, &quot;&quot;);  </span>
<span class="lineNum">  273</span>              :   </span>
<span class="lineNum">  274</span><span class="lineCov">      1  /   1: 	this-&gt;LoadFrodorc();  </span>
<span class="lineNum">  275</span><span class="lineCov">      1  /   1: 	if (network_server_connect)  </span>
<span class="lineNum">  276</span><span class="lineCov">      1  /   1: 		strncpy(ThePrefs.NetworkServer, network_server_connect,  </span>
<span class="lineNum">  277</span><span class="lineCov">      1  /   1: 				sizeof(ThePrefs.NetworkServer));  </span>
<span class="lineNum">  278</span><span class="lineCov">      1  /   1: 	panic_if (!init_graphics(),  </span>
<span class="lineNum">  279</span><span class="lineCov">      1  /   1: 			&quot;Can&#039;t initialize graphics!&#092;n&quot;);  </span>
<span class="lineNum">  280</span>              :   </span>
<span class="lineNum">  281</span><span class="lineCov">      2  /   2: 	&#047;&#047; Create and start C64  </span>
<span class="lineNum">  282</span>              : 	TheC64 = new C64;  </span>
<span class="lineNum">  283</span>              : 	DataStore::ds = new DataStore();  </span>
<span class="lineNum">  284</span>              : 	TimerController::init();  </span>
<span class="lineNum">  285</span>              : 	Gui::init();  </span>
<span class="lineNum">  286</span><span class="linePartCov">      1  /   2: 	load_rom_files();  </span>
<span class="lineNum">  287</span>              : 	TheC64-&gt;Run();  </span>
<span class="lineNum">  288</span>              :   </span>
<span class="lineNum">  289</span>              : 	delete TheC64;  </span>
<span class="lineNum">  290</span>              :   </span>
<span class="lineNum">  291</span>              : #if defined(GEKKO)  </span>
<span class="lineNum">  292</span><span class="lineCov">      1  /   1: 	fatUnmount(&quot;sd:&quot;);  </span>
<span class="lineNum">  293</span><span class="lineCov">      1  /   1: #endif  </span>
<span class="lineNum">  294</span>              : }  </span>
<span class="lineNum">  295</span><span class="lineCov">      2  /   2:   </span>
<span class="lineNum">  296</span><span class="linePartCov">      1  /   2: &#047;*  </span>
<span class="lineNum">  297</span>              :  *  Determine whether path name refers to a directory  </span>
<span class="lineNum">  298</span>              :  *&#047;  </span>
<span class="lineNum">  299</span>              :   </span>
<span class="lineNum">  300</span>              : bool IsDirectory(const char *path)  </span>
<span class="lineNum">  301</span>              : {  </span>
<span class="lineNum">  302</span>              : 	struct stat st;  </span>
<span class="lineNum">  303</span>              : 	return stat(path, &amp;st) == 0 &amp;&amp; S_ISDIR(st.st_mode);  </span>
<span class="lineNum">  304</span>              : }  </span>
</pre>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
  <tr><td class="versionInfo">Generated by: <a href="http://simonkagstrom.github.com/kcov/index.html">Kcov</a> (based on <a href="http://bcov.sourceforge.net">bcov</a>)</td></tr>
</table>
<br/>
</body>
</html>
