<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Coverage - dissy</title>
  <link rel="stylesheet" type="text/css" href="bcov.css"/>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr><td class="title">Coverage Report</td></tr>
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
  <tr>
    <td width="100%">
      <table cellpadding="1" border="0" width="100%">
        <tr>
          <td class="headerItem" width="20%">Command:</td>
          <td class="headerValue" width="80%" colspan=6>dissy</td>
        </tr>
        <tr>
          <td class="headerItem" width="20%">Date:</td>
          <td class="headerValue" width="15%">2014-03-01 10:23:30</td>
          <td width="5%"></td>
          <td class="headerItem" width="20%">Instrumented&nbsp;lines:</td>
          <td class="headerValue" width="10%">106</td>
        </tr>
        <tr>
          <td class="headerItem" width="20%">Code&nbsp;covered:</td>
          <td class="coverPerLeftHi" width="15%">78.3%</td>
          <td width="5%"></td>
          <td class="headerItem" width="20%">Executed&nbsp;lines:</td>
          <td class="headerValue" width="10%">83</td>
        </tr>
      </table>
    </td>
  </tr>
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
</table>
<pre class="source">
<span class="lineNum">    1</span>              : ###################################################################### </span>
<span class="lineNum">    2</span>              : ## </span>
<span class="lineNum">    3</span>              : ## Copyright (C) 2006,  Blekinge Institute of Technology </span>
<span class="lineNum">    4</span>              : ## </span>
<span class="lineNum">    5</span>              : ## Author:        Simon Kagstrom &lt;simon.kagstrom@gmail.com&gt; </span>
<span class="lineNum">    6</span>              : ## Description:   A function </span>
<span class="lineNum">    7</span>              : ## </span>
<span class="lineNum">    8</span>              : ## Licensed under the terms of GNU General Public License version 2 </span>
<span class="lineNum">    9</span>              : ## (or later, at your option). See COPYING file distributed with Dissy </span>
<span class="lineNum">   10</span>              : ## for full text of the license. </span>
<span class="lineNum">   11</span>              : ## </span>
<span class="lineNum">   12</span>              : ###################################################################### </span>
<span class="lineNum">   13</span><span class="lineCov">      1  /   1: import re, os, cgi </span>
<span class="lineNum">   14</span>              :  </span>
<span class="lineNum">   15</span><span class="lineCov">      1  /   1: from dissy.Config import config </span>
<span class="lineNum">   16</span><span class="lineCov">      1  /   1: from dissy.Entity import Entity, AddressableEntity </span>
<span class="lineNum">   17</span><span class="lineCov">      1  /   1: from dissy.Instruction import Instruction </span>
<span class="lineNum">   18</span><span class="lineCov">      1  /   1: from dissy.JumpStreamHandler import * </span>
<span class="lineNum">   19</span><span class="lineCov">      1  /   1: from dissy.StrEntity import StrEntity </span>
<span class="lineNum">   20</span>              :  </span>
<span class="lineNum">   21</span><span class="lineCov">      1  /   1: ADDRESS_REGEXP  = &quot;[0-9,a-f,A-F]+&quot; </span>
<span class="lineNum">   22</span><span class="lineCov">      1  /   1: ENCODING_REGEXP = ADDRESS_REGEXP + &quot;[ ]&quot; </span>
<span class="lineNum">   23</span><span class="lineCov">      1  /   1: INSN_REGEXP     = &quot;[0-9,a-z,A-Z,_,&#092;-,&#092;.,&#092;+]+&quot; </span>
<span class="lineNum">   24</span><span class="lineCov">      1  /   1: INSN_ARGS_REGEXP= &quot;&#092;**[a-z,A-Z,0-9,_,&#092;,,&#092;(,&#092;),&#092;%,&#092;$,&#092;[,&#092;],!,#,&#092;-, ,&amp;,{,},&#092;*,&#092;+&#092;.]+&quot; </span>
<span class="lineNum">   25</span>              :  </span>
<span class="lineNum">   26</span><span class="lineCov">      1  /   1: insnRegExp = re.compile(&quot;[ ]*(&quot; + ADDRESS_REGEXP + &quot;):[ &#092;t]+((?:&quot; + ENCODING_REGEXP +&quot;)*)[ &#092;t]+(&quot; + INSN_REGEXP + &quot;)+[ &#092;t]*(&quot; + INSN_ARGS_REGEXP + &quot;)*&quot;) </span>
<span class="lineNum">   27</span>              :  </span>
<span class="lineNum">   28</span><span class="lineCov">      1  /   1: class Function(AddressableEntity): </span>
<span class="lineNum">   29</span><span class="lineCov">      1  /   1:     def __init__(self, fileContainer, address, label, size=0): </span>
<span class="lineNum">   30</span><span class="lineCov">      1  /   1:         AddressableEntity.__init__(self, address = address, endAddress = address + size, baseAddress = fileContainer.baseAddress) </span>
<span class="lineNum">   31</span><span class="lineCov">      1  /   1:         self.label = label </span>
<span class="lineNum">   32</span><span class="lineCov">      1  /   1:         self.all = [] </span>
<span class="lineNum">   33</span><span class="lineCov">      1  /   1:         self.insns = [] </span>
<span class="lineNum">   34</span><span class="lineCov">      1  /   1:         self.addressToIns = {} </span>
<span class="lineNum">   35</span><span class="lineCov">      1  /   1:         self.file = fileContainer </span>
<span class="lineNum">   36</span>              :  </span>
<span class="lineNum">   37</span><span class="lineCov">      1  /   1:     def addInstruction(self, insn): </span>
<span class="lineNum">   38</span>              :         &quot;&quot;&quot;Add an instruction to this function&quot;&quot;&quot; </span>
<span class="lineNum">   39</span><span class="lineCov">      1  /   1:         self.insns.append(insn) </span>
<span class="lineNum">   40</span><span class="lineCov">      1  /   1:         self.addressToIns[insn.address] = insn </span>
<span class="lineNum">   41</span><span class="lineCov">      1  /   1:         self.all.append(insn) </span>
<span class="lineNum">   42</span><span class="lineCov">      1  /   1:         if insn.address &gt; self.endAddress: </span>
<span class="lineNum">   43</span><span class="lineNoCov">      0  /   1:             self.setSize(insn.address - self.address) </span>
<span class="lineNum">   44</span>              :  </span>
<span class="lineNum">   45</span><span class="lineCov">      1  /   1:     def getFile(self): </span>
<span class="lineNum">   46</span><span class="lineCov">      1  /   1:         return self.file </span>
<span class="lineNum">   47</span>              :  </span>
<span class="lineNum">   48</span><span class="lineCov">      1  /   1:     def addOther(self, other): </span>
<span class="lineNum">   49</span><span class="lineCov">      1  /   1:         self.all.append(StrEntity(self, other)) </span>
<span class="lineNum">   50</span>              :  </span>
<span class="lineNum">   51</span><span class="lineCov">      1  /   1:     def __getInstructionByOffset(self, insn, dir): </span>
<span class="lineNum">   52</span><span class="lineNoCov">      0  /   1:         idx = self.all.index(insn) </span>
<span class="lineNum">   53</span><span class="lineNoCov">      0  /   1:         return self.insns[ idx + dir ] </span>
<span class="lineNum">   54</span>              :  </span>
<span class="lineNum">   55</span><span class="lineCov">      1  /   1:     def getPrevInstruction(self, insn): </span>
<span class="lineNum">   56</span>              :         &quot;&quot;&quot;Return the previous instruction from @a insn&quot;&quot;&quot; </span>
<span class="lineNum">   57</span><span class="lineNoCov">      0  /   1:         return self.__getInstructionByOffset(insn, -1) </span>
<span class="lineNum">   58</span>              :  </span>
<span class="lineNum">   59</span><span class="lineCov">      1  /   1:     def getNextInstruction(self, insn): </span>
<span class="lineNum">   60</span>              :         &quot;&quot;&quot;Return the next instruction from @a insn&quot;&quot;&quot; </span>
<span class="lineNum">   61</span><span class="lineNoCov">      0  /   1:         return self.__getInstructionByOffset(insn, 1) </span>
<span class="lineNum">   62</span>              :  </span>
<span class="lineNum">   63</span><span class="lineCov">      1  /   1:     def lookup(self, address): </span>
<span class="lineNum">   64</span><span class="lineNoCov">      0  /   1:         return self.addressToIns.get(address, None) </span>
<span class="lineNum">   65</span>              :  </span>
<span class="lineNum">   66</span><span class="lineCov">      1  /   1:     def parse(self, try64bitWorkaround=False): </span>
<span class="lineNum">   67</span>              :         &quot;&quot;&quot;Parse the function.&quot;&quot;&quot; </span>
<span class="lineNum">   68</span><span class="lineCov">      1  /   1:         count = 0 </span>
<span class="lineNum">   69</span><span class="lineCov">      1  /   1:         start, end = self.getExtents() </span>
<span class="lineNum">   70</span><span class="lineCov">      1  /   1:         if try64bitWorkaround: </span>
<span class="lineNum">   71</span><span class="lineNoCov">      0  /   1:             if start &amp; (1&lt;&lt;31): </span>
<span class="lineNum">   72</span><span class="lineNoCov">      0  /   1:                 start = long(start) | 0xffffffff00000000 </span>
<span class="lineNum">   73</span><span class="lineNoCov">      0  /   1:             if end &amp; (1&lt;&lt;31): </span>
<span class="lineNum">   74</span><span class="lineNoCov">      0  /   1:                 end = long(end) | 0xffffffff00000000 </span>
<span class="lineNum">   75</span>              :  </span>
<span class="lineNum">   76</span><span class="lineCov">      1  /   1:         lines = self.file.getFunctionObjdump(self.label, start, end) </span>
<span class="lineNum">   77</span>              :  </span>
<span class="lineNum">   78</span><span class="lineCov">      1  /   1:         self.insns = [] </span>
<span class="lineNum">   79</span><span class="lineCov">      1  /   1:         self.all = [] </span>
<span class="lineNum">   80</span><span class="lineCov">      1  /   1:         firstNonEmpty=False </span>
<span class="lineNum">   81</span><span class="lineCov">      1  /   1:         for line in lines: </span>
<span class="lineNum">   82</span>              :             # Weed away some unneeded stuff </span>
<span class="lineNum">   83</span><span class="lineCov">      1  /   1:             if line.startswith(&quot;Disassembly of section &quot;) or line.startswith(&quot;%s: &quot; % (self.file.filename)): </span>
<span class="lineNum">   84</span><span class="lineCov">      1  /   1:                 continue </span>
<span class="lineNum">   85</span><span class="lineCov">      1  /   1:             if not firstNonEmpty and line.strip() == &quot;&quot;: </span>
<span class="lineNum">   86</span><span class="lineCov">      1  /   1:                 continue </span>
<span class="lineNum">   87</span>              :  </span>
<span class="lineNum">   88</span><span class="lineCov">      1  /   1:             firstNonEmpty=True </span>
<span class="lineNum">   89</span><span class="lineCov">      1  /   1:             r = insnRegExp.match(line) </span>
<span class="lineNum">   90</span><span class="lineCov">      1  /   1:             if r != None: </span>
<span class="lineNum">   91</span><span class="lineCov">      1  /   1:                 insn = Instruction(self, long(&quot;0x&quot; + r.group(1),16), r.group(2), r.group(3), r.group(4)) </span>
<span class="lineNum">   92</span><span class="lineCov">      1  /   1:                 self.addInstruction(insn) </span>
<span class="lineNum">   93</span><span class="lineCov">      1  /   1:                 count = count + 1 </span>
<span class="lineNum">   94</span>              :             else: </span>
<span class="lineNum">   95</span><span class="lineCov">      1  /   1:                 self.addOther(cgi.escape(line)) </span>
<span class="lineNum">   96</span>              :  </span>
<span class="lineNum">   97</span><span class="lineCov">      1  /   1:         if count == 0 and try64bitWorkaround == False: </span>
<span class="lineNum">   98</span>              :             # If we couldn&#039;t add anything interesting, try the 64-bit </span>
<span class="lineNum">   99</span>              :             # workaround (for e.g., MIPS). See http:&#047;&#047;bugs.debian.org&#047;cgi-bin&#047;bugreport.cgi?bug=369343 </span>
<span class="lineNum">  100</span><span class="lineNoCov">      0  /   1:             return self.parse(try64bitWorkaround = True) </span>
<span class="lineNum">  101</span>              :  </span>
<span class="lineNum">  102</span><span class="lineCov">      1  /   1:     def link(self): </span>
<span class="lineNum">  103</span>              :         &quot;&quot;&quot; </span>
<span class="lineNum">  104</span>              :         Link the local jumps in this function. External jumps are </span>
<span class="lineNum">  105</span>              :         linked to the function they reside in. </span>
<span class="lineNum">  106</span>              :         &quot;&quot;&quot; </span>
<span class="lineNum">  107</span><span class="lineCov">      1  /   1:         unresolved = [] </span>
<span class="lineNum">  108</span><span class="lineCov">      1  /   1:         for insn in self.insns: </span>
<span class="lineNum">  109</span><span class="lineCov">      1  /   1:             if insn.hasLink() and not insn.link(): </span>
<span class="lineNum">  110</span><span class="lineNoCov">      0  /   1:                 unresolved.append(insn) </span>
<span class="lineNum">  111</span>              :  </span>
<span class="lineNum">  112</span><span class="lineCov">      1  /   1:         positive, negative = self.getJumpDicts() </span>
<span class="lineNum">  113</span>              :  </span>
<span class="lineNum">  114</span>              :         # Fill in the jumps, forwards... </span>
<span class="lineNum">  115</span><span class="lineCov">      1  /   1:         self.fillInJumpStreams(positive, False) </span>
<span class="lineNum">  116</span>              :         # ... and backwards </span>
<span class="lineNum">  117</span><span class="lineCov">      1  /   1:         self.all.reverse() </span>
<span class="lineNum">  118</span><span class="lineCov">      1  /   1:         self.fillInJumpStreams(negative, True) </span>
<span class="lineNum">  119</span><span class="lineCov">      1  /   1:         self.all.reverse() </span>
<span class="lineNum">  120</span>              :  </span>
<span class="lineNum">  121</span><span class="lineCov">      1  /   1:         return unresolved </span>
<span class="lineNum">  122</span>              :  </span>
<span class="lineNum">  123</span><span class="lineCov">      1  /   1:     def getInstructions(self): </span>
<span class="lineNum">  124</span><span class="lineNoCov">      0  /   1:         return self.insns </span>
<span class="lineNum">  125</span>              :  </span>
<span class="lineNum">  126</span><span class="lineCov">      1  /   1:     def getAll(self): </span>
<span class="lineNum">  127</span><span class="lineCov">      1  /   1:         return self.all </span>
<span class="lineNum">  128</span>              :  </span>
<span class="lineNum">  129</span><span class="lineCov">      1  /   1:     def getJumpDicts(self): </span>
<span class="lineNum">  130</span>              :         &quot;&quot;&quot; </span>
<span class="lineNum">  131</span>              :         Get jump dictionaries for the forward and backward jumps. </span>
<span class="lineNum">  132</span>              :         &quot;&quot;&quot; </span>
<span class="lineNum">  133</span><span class="lineCov">      1  /   1:         positive = {} </span>
<span class="lineNum">  134</span><span class="lineCov">      1  /   1:         negative = {} </span>
<span class="lineNum">  135</span><span class="lineCov">      1  /   1:         for insn in self.insns: </span>
<span class="lineNum">  136</span><span class="lineCov">      1  /   1:             other = insn.getOutLink() </span>
<span class="lineNum">  137</span><span class="lineCov">      1  /   1:             if isinstance(other, Instruction) and other != insn: </span>
<span class="lineNum">  138</span><span class="lineNoCov">      0  /   1:                 if other.address &lt; insn.address: </span>
<span class="lineNum">  139</span>              :                     # Jump from insn to other BACKWARDS </span>
<span class="lineNum">  140</span><span class="lineNoCov">      0  /   1:                     negative[insn.address] = (insn, other) </span>
<span class="lineNum">  141</span>              :                 else: </span>
<span class="lineNum">  142</span>              :                     # Jump from insn to other FORWARDS </span>
<span class="lineNum">  143</span><span class="lineNoCov">      0  /   1:                     positive[insn.address] = (insn, other) </span>
<span class="lineNum">  144</span><span class="lineCov">      1  /   1:         return positive, negative </span>
<span class="lineNum">  145</span>              :  </span>
<span class="lineNum">  146</span><span class="lineCov">      1  /   1:     def fillInJumpStreams(self, jumpDict, left): </span>
<span class="lineNum">  147</span>              :         &quot;&quot;&quot; </span>
<span class="lineNum">  148</span>              :         Fill in the jump streams for a dictionary of start </span>
<span class="lineNum">  149</span>              :         addresses. Specify if the left or right streams should be </span>
<span class="lineNum">  150</span>              :         generated. </span>
<span class="lineNum">  151</span>              :         &quot;&quot;&quot; </span>
<span class="lineNum">  152</span><span class="lineCov">      1  /   1:         jumpStreamHandler = JumpStreamHandler() </span>
<span class="lineNum">  153</span><span class="lineCov">      1  /   1:         for insn in self.all: </span>
<span class="lineNum">  154</span><span class="lineCov">      1  /   1:             if isinstance(insn, Instruction): </span>
<span class="lineNum">  155</span>              :                 # Something starts on this address </span>
<span class="lineNum">  156</span><span class="lineCov">      1  /   1:                 if jumpDict.has_key(insn.address): </span>
<span class="lineNum">  157</span><span class="lineNoCov">      0  /   1:                     stream = jumpStreamHandler.alloc() </span>
<span class="lineNum">  158</span><span class="lineNoCov">      0  /   1:                     if stream != None: </span>
<span class="lineNum">  159</span><span class="lineNoCov">      0  /   1:                         stream.start(jumpDict[insn.address] ) </span>
<span class="lineNum">  160</span><span class="lineCov">      1  /   1:             jumpStreamHandler.update(insn) </span>
<span class="lineNum">  161</span><span class="lineCov">      1  /   1:             if left == True: </span>
<span class="lineNum">  162</span><span class="lineCov">      1  /   1:                 insn.left_state = jumpStreamHandler.getStateTuple() </span>
<span class="lineNum">  163</span>              :             else: </span>
<span class="lineNum">  164</span><span class="lineCov">      1  /   1:                 insn.right_state = jumpStreamHandler.getStateTuple() </span>
<span class="lineNum">  165</span>              :  </span>
<span class="lineNum">  166</span>              :  </span>
<span class="lineNum">  167</span><span class="lineCov">      1  /   1:     def __str__(self): </span>
<span class="lineNum">  168</span><span class="lineNoCov">      0  /   1:         out = str(&quot;0x%08x&quot; % self.address) + &quot; &quot; + str(self.label) + &quot;:&#092;n&quot; </span>
<span class="lineNum">  169</span><span class="lineNoCov">      0  /   1:         for insn in self.insns: </span>
<span class="lineNum">  170</span><span class="lineNoCov">      0  /   1:             out = out + str(insn) + &quot;&#092;n&quot; </span>
<span class="lineNum">  171</span><span class="lineNoCov">      0  /   1:         return out </span>
</pre>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
  <tr><td class="versionInfo">Generated by: <a href="http://simonkagstrom.github.com/kcov/index.html">Kcov</a></td></tr>
</table>
<br/>
</body>
</html>
