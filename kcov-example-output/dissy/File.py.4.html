<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Coverage - dissy</title>
  <link rel="stylesheet" type="text/css" href="bcov.css"/>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr><td class="title">Coverage Report</td></tr>
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
  <tr>
    <td width="100%">
      <table cellpadding="1" border="0" width="100%">
        <tr>
          <td class="headerItem" width="20%">Command:</td>
          <td class="headerValue" width="80%" colspan=6>dissy</td>
        </tr>
        <tr>
          <td class="headerItem" width="20%">Date:</td>
          <td class="headerValue" width="15%">2014-03-01 10:23:30</td>
          <td width="5%"></td>
          <td class="headerItem" width="20%">Instrumented&nbsp;lines:</td>
          <td class="headerValue" width="10%">255</td>
        </tr>
        <tr>
          <td class="headerItem" width="20%">Code&nbsp;covered:</td>
          <td class="coverPerLeftMed" width="15%">54.5%</td>
          <td width="5%"></td>
          <td class="headerItem" width="20%">Executed&nbsp;lines:</td>
          <td class="headerValue" width="10%">139</td>
        </tr>
      </table>
    </td>
  </tr>
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
</table>
<pre class="source">
<span class="lineNum">    1</span>              : ###################################################################### </span>
<span class="lineNum">    2</span>              : ## </span>
<span class="lineNum">    3</span>              : ## Copyright (C) 2006,  Blekinge Institute of Technology </span>
<span class="lineNum">    4</span>              : ## </span>
<span class="lineNum">    5</span>              : ## Author:        Simon Kagstrom &lt;simon.kagstrom@gmail.com&gt; </span>
<span class="lineNum">    6</span>              : ## Description:   Describes one file </span>
<span class="lineNum">    7</span>              : ## </span>
<span class="lineNum">    8</span>              : ## Licensed under the terms of GNU General Public License version 2 </span>
<span class="lineNum">    9</span>              : ## (or later, at your option). See COPYING file distributed with Dissy </span>
<span class="lineNum">   10</span>              : ## for full text of the license. </span>
<span class="lineNum">   11</span>              : ## </span>
<span class="lineNum">   12</span>              : ###################################################################### </span>
<span class="lineNum">   13</span><span class="lineCov">      1  /   1: import cgi, os, sys, re </span>
<span class="lineNum">   14</span><span class="lineCov">      1  /   1: import cPickle as pickle </span>
<span class="lineNum">   15</span>              :  </span>
<span class="lineNum">   16</span><span class="lineCov">      1  /   1: sys.path.append(&quot;.&quot;) </span>
<span class="lineNum">   17</span><span class="lineCov">      1  /   1: import dissy, dissy.architecture </span>
<span class="lineNum">   18</span>              :  </span>
<span class="lineNum">   19</span><span class="lineCov">      1  /   1: from dissy.Function import * </span>
<span class="lineNum">   20</span><span class="lineCov">      1  /   1: from dissy.Instruction import * </span>
<span class="lineNum">   21</span><span class="lineCov">      1  /   1: from dissy.Data import * </span>
<span class="lineNum">   22</span><span class="lineCov">      1  /   1: from dissy.Entity import AddressableEntity </span>
<span class="lineNum">   23</span>              :  </span>
<span class="lineNum">   24</span><span class="lineCov">      1  /   1: ADDRESS_REGEXP  = &quot;[0-9,a-f,A-F]+&quot; </span>
<span class="lineNum">   25</span><span class="lineCov">      1  /   1: FUNCTION_REGEXP = &quot;(?:[.]*)[_,0-9,a-z,A-Z,&#092;:,&#092;*,&#092;,&#092;(,&#092;), ,&lt;,&gt;,~,&#092;.,&amp;,=,&#092;[,&#092;],&#092;+,&#092;-,&#092;*,&#092;&#047;,&#092;|,&#092;^,&#092;%]+&quot; </span>
<span class="lineNum">   26</span>              :  </span>
<span class="lineNum">   27</span><span class="lineCov">      1  /   1: symbolRegexp = re.compile(&quot;(&quot; + ADDRESS_REGEXP + &quot;)* *(&quot; + ADDRESS_REGEXP + &quot;)* ([A,B,C,D,G,I,N,R,S,T,U,V,W,a,b,c,d,g,i,n,r,s,t,u,v,w,-,?]{1}) (&quot;+ FUNCTION_REGEXP + &quot;){1}&quot;) </span>
<span class="lineNum">   28</span>              :  </span>
<span class="lineNum">   29</span>              : # Followed by size, but let&#039;s just skip it </span>
<span class="lineNum">   30</span><span class="lineCov">      1  /   1: linuxKernelCrashRegexp = re.compile(&quot;(&quot; + FUNCTION_REGEXP + &quot;){1}&quot; + &quot;&#092;+[0x]*(&quot; + ADDRESS_REGEXP + &quot;){1}&quot;) </span>
<span class="lineNum">   31</span>              :  </span>
<span class="lineNum">   32</span><span class="lineCov">      1  /   1: TYPE_UNDEFINED = 0 </span>
<span class="lineNum">   33</span><span class="lineCov">      1  /   1: TYPE_TEXT = 1 </span>
<span class="lineNum">   34</span><span class="lineCov">      1  /   1: TYPE_RODATA = 2 </span>
<span class="lineNum">   35</span><span class="lineCov">      1  /   1: TYPE_DATA = 3 </span>
<span class="lineNum">   36</span><span class="lineCov">      1  /   1: TYPE_BSS  = 4 </span>
<span class="lineNum">   37</span>              :  </span>
<span class="lineNum">   38</span><span class="lineCov">      1  /   1: typeToClass = { </span>
<span class="lineNum">   39</span><span class="lineCov">      1  /   1:     TYPE_TEXT : Function, </span>
<span class="lineNum">   40</span><span class="lineCov">      1  /   1:     TYPE_RODATA : RoData, </span>
<span class="lineNum">   41</span><span class="lineCov">      1  /   1:     TYPE_DATA : Data, </span>
<span class="lineNum">   42</span><span class="lineCov">      1  /   1:     TYPE_BSS : Bss, </span>
<span class="lineNum">   43</span><span class="lineNoCov">      0  /   1: } </span>
<span class="lineNum">   44</span>              :  </span>
<span class="lineNum">   45</span><span class="lineCov">      1  /   1: def shouldFilter(name): </span>
<span class="lineNum">   46</span><span class="lineCov">      1  /   1:     forbidden = [&quot;_Jv_RegisterClasses&quot;, &quot;__gmon_start__&quot;] </span>
<span class="lineNum">   47</span>              :  </span>
<span class="lineNum">   48</span><span class="lineCov">      1  /   1:     if name in forbidden: </span>
<span class="lineNum">   49</span><span class="lineCov">      1  /   1:         return True </span>
<span class="lineNum">   50</span>              :  </span>
<span class="lineNum">   51</span><span class="lineCov">      1  /   1:     return False </span>
<span class="lineNum">   52</span>              :  </span>
<span class="lineNum">   53</span><span class="lineCov">      1  /   1: def getObjType(s): </span>
<span class="lineNum">   54</span><span class="lineCov">      1  /   1:     if s in (&#039;u&#039;, &#039;U&#039;, &#039;N&#039;): </span>
<span class="lineNum">   55</span><span class="lineCov">      1  /   1:         return TYPE_UNDEFINED </span>
<span class="lineNum">   56</span><span class="lineCov">      1  /   1:     elif s in (&#039;d&#039;, &#039;D&#039;): </span>
<span class="lineNum">   57</span><span class="lineCov">      1  /   1:         return TYPE_DATA </span>
<span class="lineNum">   58</span><span class="lineCov">      1  /   1:     elif s in (&#039;r&#039;, &#039;R&#039;): </span>
<span class="lineNum">   59</span><span class="lineCov">      1  /   1:         return TYPE_RODATA </span>
<span class="lineNum">   60</span><span class="lineCov">      1  /   1:     elif s in (&#039;b&#039;, &#039;B&#039;, &#039;s&#039;, &#039;S&#039;, &#039;c&#039;, &#039;C&#039;): </span>
<span class="lineNum">   61</span><span class="lineCov">      1  /   1:         return TYPE_BSS </span>
<span class="lineNum">   62</span><span class="lineCov">      1  /   1:     elif s in (&#039;t&#039;, &#039;T&#039;, &#039;W&#039;, &#039;w&#039;): </span>
<span class="lineNum">   63</span><span class="lineCov">      1  /   1:         return TYPE_TEXT </span>
<span class="lineNum">   64</span><span class="lineCov">      1  /   1:     return TYPE_DATA </span>
<span class="lineNum">   65</span>              :  </span>
<span class="lineNum">   66</span>              :  </span>
<span class="lineNum">   67</span><span class="lineCov">      1  /   1: class BaseFile(AddressableEntity): </span>
<span class="lineNum">   68</span><span class="lineCov">      1  /   1:     def __init__(self, baseAddress = 0): </span>
<span class="lineNum">   69</span><span class="lineNoCov">      0  /   1:         global global_file </span>
<span class="lineNum">   70</span><span class="lineCov">      1  /   1:         AddressableEntity.__init__(self, baseAddress = baseAddress) </span>
<span class="lineNum">   71</span><span class="lineCov">      1  /   1:         self.symbols = [] </span>
<span class="lineNum">   72</span><span class="lineCov">      1  /   1:         self.functions = [] </span>
<span class="lineNum">   73</span><span class="lineCov">      1  /   1:         self.data = [] </span>
<span class="lineNum">   74</span><span class="lineCov">      1  /   1:         self.arch = &quot;intel&quot; </span>
<span class="lineNum">   75</span><span class="lineCov">      1  /   1:         global_file = self </span>
<span class="lineNum">   76</span>              :  </span>
<span class="lineNum">   77</span><span class="lineCov">      1  /   1:     def lookup_int(self, address): </span>
<span class="lineNum">   78</span><span class="lineNoCov">      0  /   1:         for sym in self.symbols: </span>
<span class="lineNum">   79</span><span class="lineNoCov">      0  /   1:             extents = sym.getExtents() </span>
<span class="lineNum">   80</span><span class="lineNoCov">      0  /   1:             if address &gt;= extents[0] and address &lt; extents[1]: </span>
<span class="lineNum">   81</span><span class="lineNoCov">      0  /   1:                 return sym </span>
<span class="lineNum">   82</span><span class="lineNoCov">      0  /   1:         return None </span>
<span class="lineNum">   83</span>              :  </span>
<span class="lineNum">   84</span><span class="lineCov">      1  /   1:     def link(self): </span>
<span class="lineNum">   85</span><span class="lineNoCov">      0  /   1:         for fn in self.functions: </span>
<span class="lineNum">   86</span><span class="lineNoCov">      0  /   1:             unresolved = fn.link() </span>
<span class="lineNum">   87</span><span class="lineNoCov">      0  /   1:             for insn in unresolved: </span>
<span class="lineNum">   88</span><span class="lineNoCov">      0  /   1:                 other = self.lookup(insn.address) </span>
<span class="lineNum">   89</span><span class="lineNoCov">      0  /   1:                 if other: </span>
<span class="lineNum">   90</span><span class="lineNoCov">      0  /   1:                     insn.linkTo(other) </span>
<span class="lineNum">   91</span>              :  </span>
<span class="lineNum">   92</span><span class="lineCov">      1  /   1:     def lookup_str(self, label): </span>
<span class="lineNum">   93</span><span class="lineNoCov">      0  /   1:         for sym in self.symbols: </span>
<span class="lineNum">   94</span><span class="lineNoCov">      0  /   1:             if label == sym.getLabel(): </span>
<span class="lineNum">   95</span><span class="lineNoCov">      0  /   1:                 return sym </span>
<span class="lineNum">   96</span><span class="lineNoCov">      0  /   1:         return None </span>
<span class="lineNum">   97</span>              :  </span>
<span class="lineNum">   98</span><span class="lineCov">      1  /   1:     def lookup(self, param): </span>
<span class="lineNum">   99</span><span class="lineNoCov">      0  /   1:         &quot;Lookup a label or an address&quot; </span>
<span class="lineNum">  100</span><span class="lineNoCov">      0  /   1:         if isinstance(param, long): </span>
<span class="lineNum">  101</span><span class="lineNoCov">      0  /   1:             return self.lookup_int(param) </span>
<span class="lineNum">  102</span><span class="lineNoCov">      0  /   1:         return self.lookup_str(param) </span>
<span class="lineNum">  103</span>              :  </span>
<span class="lineNum">  104</span><span class="lineCov">      1  /   1:     def getArch(self): </span>
<span class="lineNum">  105</span><span class="lineCov">      1  /   1:         return self.arch </span>
<span class="lineNum">  106</span>              :  </span>
<span class="lineNum">  107</span><span class="lineCov">      1  /   1:     def hasSymbols(self): </span>
<span class="lineNum">  108</span><span class="lineCov">      1  /   1:         return True </span>
<span class="lineNum">  109</span>              :  </span>
<span class="lineNum">  110</span><span class="lineCov">      1  /   1:     def parse(self): </span>
<span class="lineNum">  111</span>              :         &quot;&quot;&quot;Parses the output of &#039;nm&#039;, to get the list of symbols&quot;&quot;&quot; </span>
<span class="lineNum">  112</span><span class="lineCov">      1  /   1:         lines = self.getNmLines() </span>
<span class="lineNum">  113</span><span class="lineCov">      1  /   1:         for line in lines: </span>
<span class="lineNum">  114</span><span class="lineCov">      1  /   1:             r = symbolRegexp.match(line) </span>
<span class="lineNum">  115</span><span class="lineCov">      1  /   1:             if r == None: </span>
<span class="lineNum">  116</span><span class="lineNoCov">      0  /   1:                 continue </span>
<span class="lineNum">  117</span><span class="lineCov">      1  /   1:             address = 0 </span>
<span class="lineNum">  118</span><span class="lineCov">      1  /   1:             size = 0 </span>
<span class="lineNum">  119</span><span class="lineCov">      1  /   1:             if r.group(1) != None: </span>
<span class="lineNum">  120</span><span class="lineCov">      1  /   1:                 address = long(&quot;0x&quot; + r.group(1), 16) </span>
<span class="lineNum">  121</span><span class="lineCov">      1  /   1:             if r.group(2) != None: </span>
<span class="lineNum">  122</span><span class="lineCov">      1  /   1:                 size = long(&quot;0x&quot; + r.group(2), 16) </span>
<span class="lineNum">  123</span><span class="lineCov">      1  /   1:             objType = getObjType(r.group(3)) </span>
<span class="lineNum">  124</span><span class="lineCov">      1  /   1:             label = cgi.escape(r.group(4)) </span>
<span class="lineNum">  125</span>              :  </span>
<span class="lineNum">  126</span><span class="lineCov">      1  /   1:             if size == 0: </span>
<span class="lineNum">  127</span><span class="lineCov">      1  /   1:                 idx = lines.index(line) + 1 </span>
<span class="lineNum">  128</span><span class="lineCov">      1  /   1:                 if idx &lt; len(lines)-1: </span>
<span class="lineNum">  129</span>              :                     # The size is the next real symbol&#039;s line.adr - this line.adr </span>
<span class="lineNum">  130</span><span class="lineCov">      1  /   1:                     s = symbolRegexp.match(lines[idx]) </span>
<span class="lineNum">  131</span><span class="lineCov">      1  /   1:                     if s == None: </span>
<span class="lineNum">  132</span><span class="lineNoCov">      0  /   1:                         continue </span>
<span class="lineNum">  133</span>              :  </span>
<span class="lineNum">  134</span><span class="lineCov">      1  /   1:                     while idx &lt; len(lines)-1 and s == None or (s and s.group(1) == None) or &#092; </span>
<span class="lineNum">  135</span><span class="lineCov">      1  /   1:                         (s and s.group(3) in (&#039;t&#039;, &#039;W&#039;)): </span>
<span class="lineNum">  136</span>              :                         #ignore symbols with type &#039;t&#039; and &#039;W&#039;, this helps some procs on e.g. ATMEL </span>
<span class="lineNum">  137</span><span class="lineCov">      1  /   1:                         idx = idx + 1 </span>
<span class="lineNum">  138</span><span class="lineCov">      1  /   1:                         s = symbolRegexp.match(lines[idx]) </span>
<span class="lineNum">  139</span>              :  </span>
<span class="lineNum">  140</span><span class="lineCov">      1  /   1:                     nextAdr = long(&quot;0x&quot; + s.group(1), 16) </span>
<span class="lineNum">  141</span><span class="lineCov">      1  /   1:                     size = nextAdr - address </span>
<span class="lineNum">  142</span>              :                 else: </span>
<span class="lineNum">  143</span>              :                     # FIXME: This is a bug - the last symbol will be too small. </span>
<span class="lineNum">  144</span>              :                     # This can be fixed by e.g., using the section size </span>
<span class="lineNum">  145</span><span class="lineCov">      1  /   1:                     size = 0 </span>
<span class="lineNum">  146</span>              :  </span>
<span class="lineNum">  147</span><span class="lineCov">      1  /   1:             if objType == TYPE_UNDEFINED: </span>
<span class="lineNum">  148</span><span class="lineCov">      1  /   1:                 continue </span>
<span class="lineNum">  149</span>              :  </span>
<span class="lineNum">  150</span><span class="lineCov">      1  /   1:             if shouldFilter(label): </span>
<span class="lineNum">  151</span><span class="lineCov">      1  /   1:                 continue </span>
<span class="lineNum">  152</span>              :  </span>
<span class="lineNum">  153</span><span class="lineCov">      1  /   1:             if objType == TYPE_TEXT: </span>
<span class="lineNum">  154</span><span class="lineCov">      1  /   1:                 sym = typeToClass[objType](self, address, label, size) </span>
<span class="lineNum">  155</span><span class="lineCov">      1  /   1:                 self.functions.append(sym) </span>
<span class="lineNum">  156</span><span class="lineCov">      1  /   1:                 self.symbols.append(sym) </span>
<span class="lineNum">  157</span>              : #            else: </span>
<span class="lineNum">  158</span>              : #                sym = typeToClass[objType](self, address, label, size) </span>
<span class="lineNum">  159</span>              : #                self.data.append(sym) </span>
<span class="lineNum">  160</span>              :          </span>
<span class="lineNum">  161</span><span class="lineCov">      1  /   1:     def parseNoSymbols(self): </span>
<span class="lineNum">  162</span>              :         &quot;&quot;&quot;Parses the output of objdump, and create the functions&quot;&quot;&quot; </span>
<span class="lineNum">  163</span><span class="lineNoCov">      0  /   1:         lines = self.getObjdumpLines() </span>
<span class="lineNum">  164</span><span class="lineNoCov">      0  /   1:         callDests = [] </span>
<span class="lineNum">  165</span><span class="lineNoCov">      0  /   1:         for line in lines: </span>
<span class="lineNum">  166</span><span class="lineNoCov">      0  /   1:             r = insnRegExp.match(line) </span>
<span class="lineNum">  167</span><span class="lineNoCov">      0  /   1:             if r != None: </span>
<span class="lineNum">  168</span><span class="lineNoCov">      0  /   1:                 if self.arch.isCall(r.group(3)): </span>
<span class="lineNum">  169</span><span class="lineNoCov">      0  /   1:                     dst = self.arch.getJumpDestination(r.group(1), r.group(3), r.group(4)) </span>
<span class="lineNum">  170</span><span class="lineNoCov">      0  /   1:                     if dst != None: </span>
<span class="lineNum">  171</span><span class="lineNoCov">      0  /   1:                         callDests.append(dst) </span>
<span class="lineNum">  172</span>              :         # Sort the calls </span>
<span class="lineNum">  173</span><span class="lineNoCov">      0  /   1:         callDests.sort() </span>
<span class="lineNum">  174</span><span class="lineNoCov">      0  /   1:         count = 0 </span>
<span class="lineNum">  175</span><span class="lineNoCov">      0  /   1:         for call in callDests[:-1]: </span>
<span class="lineNum">  176</span><span class="lineNoCov">      0  /   1:             next = callDests[callDests.index(call)+1] </span>
<span class="lineNum">  177</span><span class="lineNoCov">      0  /   1:             if next-call == 0: </span>
<span class="lineNum">  178</span>              :                 # Empty </span>
<span class="lineNum">  179</span><span class="lineNoCov">      0  /   1:                 continue </span>
<span class="lineNum">  180</span><span class="lineNoCov">      0  /   1:             fn = Function(self, call, &quot;func%d&quot; % (count), next-call) </span>
<span class="lineNum">  181</span>              :             # This has not been prepared yet... </span>
<span class="lineNum">  182</span><span class="lineNoCov">      0  /   1:             fn.stream = None </span>
<span class="lineNum">  183</span><span class="lineNoCov">      0  /   1:             self.functions.append(fn) </span>
<span class="lineNum">  184</span><span class="lineNoCov">      0  /   1:             count = count + 1 </span>
<span class="lineNum">  185</span>              :  </span>
<span class="lineNum">  186</span><span class="lineCov">      1  /   1:     def getFunctions(self): </span>
<span class="lineNum">  187</span><span class="lineCov">      1  /   1:         return self.functions </span>
<span class="lineNum">  188</span>              :  </span>
<span class="lineNum">  189</span><span class="lineCov">      1  /   1:     def getData(self): </span>
<span class="lineNum">  190</span><span class="lineNoCov">      0  /   1:         return self.functions </span>
<span class="lineNum">  191</span>              :  </span>
<span class="lineNum">  192</span><span class="lineCov">      1  /   1: class File(BaseFile): </span>
<span class="lineNum">  193</span><span class="lineCov">      1  /   1:     def __init__(self, filename=None, baseAddress = 0): </span>
<span class="lineNum">  194</span><span class="lineCov">      1  /   1:         BaseFile.__init__(self, baseAddress = baseAddress) </span>
<span class="lineNum">  195</span><span class="lineCov">      1  /   1:         self.filename = filename </span>
<span class="lineNum">  196</span>              :  </span>
<span class="lineNum">  197</span><span class="lineCov">      1  /   1:         if filename != None: </span>
<span class="lineNum">  198</span><span class="lineCov">      1  /   1:             self.arch = dissy.architecture.getArchitecture(self.getArchStr()) </span>
<span class="lineNum">  199</span><span class="lineCov">      1  /   1:             if self.hasSymbols(): </span>
<span class="lineNum">  200</span><span class="lineCov">      1  /   1:                 self.parse() </span>
<span class="lineNum">  201</span>              :             else: </span>
<span class="lineNum">  202</span><span class="lineNoCov">      0  /   1:                 self.parseNoSymbols() </span>
<span class="lineNum">  203</span>              :  </span>
<span class="lineNum">  204</span><span class="lineCov">      1  /   1:     def getArchStr(self): </span>
<span class="lineNum">  205</span><span class="lineNoCov">      0  /   1:         &quot;Get the architecture of the file&quot; </span>
<span class="lineNum">  206</span><span class="lineCov">      1  /   1:         arch = &quot;intel&quot; # Assume Intel architecture </span>
<span class="lineNum">  207</span><span class="lineCov">      1  /   1:         f = os.popen(&quot;%s -h --wide &#039;%s&#039;&quot; % (config.readelf, self.filename)) </span>
<span class="lineNum">  208</span><span class="lineCov">      1  /   1:         for line in f: </span>
<span class="lineNum">  209</span><span class="lineCov">      1  /   1:             words = line.split() </span>
<span class="lineNum">  210</span><span class="lineCov">      1  /   1:             if len(words) &gt;= 2 and words[0] == &quot;Machine:&quot;: </span>
<span class="lineNum">  211</span><span class="lineCov">      1  /   1:                 arch = words[1].lower() </span>
<span class="lineNum">  212</span><span class="lineCov">      1  /   1:                 break </span>
<span class="lineNum">  213</span><span class="lineCov">      1  /   1:         f.close() </span>
<span class="lineNum">  214</span><span class="lineCov">      1  /   1:         return arch </span>
<span class="lineNum">  215</span>              :  </span>
<span class="lineNum">  216</span><span class="lineCov">      1  /   1:     def getNmLines(self): </span>
<span class="lineNum">  217</span><span class="lineCov">      1  /   1:         f = os.popen(&quot;%s --numeric-sort --demangle --print-size &#039;%s&#039;&quot; % (config.nm, self.filename)) </span>
<span class="lineNum">  218</span><span class="lineCov">      1  /   1:         lines = f.readlines() </span>
<span class="lineNum">  219</span><span class="lineCov">      1  /   1:         f.close() </span>
<span class="lineNum">  220</span><span class="lineCov">      1  /   1:         return lines </span>
<span class="lineNum">  221</span>              :  </span>
<span class="lineNum">  222</span><span class="lineCov">      1  /   1:     def getObjdumpLines(self): </span>
<span class="lineNum">  223</span><span class="lineNoCov">      0  /   1:         &quot;Parse the functions from this file (without symbols)&quot; </span>
<span class="lineNum">  224</span><span class="lineNoCov">      0  /   1:         f = os.popen(&quot;%s --disassemble --demangle --disassemble-zeroes &#039;%s&#039;&quot; % (config.objdump, self.filename)) </span>
<span class="lineNum">  225</span><span class="lineNoCov">      0  /   1:         for line in f: </span>
<span class="lineNum">  226</span><span class="lineNoCov">      0  /   1:             yield line </span>
<span class="lineNum">  227</span><span class="lineNoCov">      0  /   1:         f.close() </span>
<span class="lineNum">  228</span>              :  </span>
<span class="lineNum">  229</span><span class="lineCov">      1  /   1:     def getFunctionObjdump(self, funclabel, start, end): </span>
<span class="lineNum">  230</span><span class="lineCov">      1  /   1:         s = &quot;%s --wide --demangle --disassemble-zeroes --source --start-address=0x%Lx --stop-address=0x%Lx &#039;%s&#039;&quot; % (config.objdump, start, end, self.filename) </span>
<span class="lineNum">  231</span><span class="lineCov">      1  /   1:         f = os.popen(s) </span>
<span class="lineNum">  232</span><span class="lineCov">      1  /   1:         for line in f: </span>
<span class="lineNum">  233</span><span class="lineCov">      1  /   1:             yield line </span>
<span class="lineNum">  234</span><span class="lineCov">      1  /   1:         f.close() </span>
<span class="lineNum">  235</span>              :  </span>
<span class="lineNum">  236</span><span class="lineCov">      1  /   1:     def getObjdumpSourceLines(self): </span>
<span class="lineNum">  237</span><span class="lineNoCov">      0  /   1:         s = &quot;%s --wide --demangle --disassemble-zeroes --source &#039;%s&#039;&quot; % (config.objdump, self.filename) </span>
<span class="lineNum">  238</span><span class="lineNoCov">      0  /   1:         f = os.popen(s) </span>
<span class="lineNum">  239</span><span class="lineNoCov">      0  /   1:         for line in f: </span>
<span class="lineNum">  240</span><span class="lineNoCov">      0  /   1:             yield line </span>
<span class="lineNum">  241</span><span class="lineNoCov">      0  /   1:         f.close() </span>
<span class="lineNum">  242</span>              :  </span>
<span class="lineNum">  243</span><span class="lineCov">      1  /   1:     def __str__(self): </span>
<span class="lineNum">  244</span><span class="lineNoCov">      0  /   1:         out = &quot;%s: &quot; % (self.filename) </span>
<span class="lineNum">  245</span><span class="lineNoCov">      0  /   1:         for fn in self.functions: </span>
<span class="lineNum">  246</span><span class="lineNoCov">      0  /   1:             out = out + str(fn) </span>
<span class="lineNum">  247</span><span class="lineNoCov">      0  /   1:         return out </span>
<span class="lineNum">  248</span>              :  </span>
<span class="lineNum">  249</span><span class="lineCov">      1  /   1:     def toExportedFile(self): </span>
<span class="lineNum">  250</span><span class="lineNoCov">      0  /   1:         expfile = ExportedFile() </span>
<span class="lineNum">  251</span><span class="lineNoCov">      0  /   1:         expfile.archStr = self.getArchStr() </span>
<span class="lineNum">  252</span><span class="lineNoCov">      0  /   1:         expfile.objdumpLines = list(self.getObjdumpLines()) </span>
<span class="lineNum">  253</span><span class="lineNoCov">      0  /   1:         expfile.objdumpSourceLines = list(self.getObjdumpSourceLines()) </span>
<span class="lineNum">  254</span><span class="lineNoCov">      0  /   1:         expfile.nmLines = list(self.getNmLines()) </span>
<span class="lineNum">  255</span><span class="lineNoCov">      0  /   1:         return expfile </span>
<span class="lineNum">  256</span>              :  </span>
<span class="lineNum">  257</span><span class="lineCov">      1  /   1: class ExportedFile(BaseFile): </span>
<span class="lineNum">  258</span><span class="lineCov">      1  /   1:     def __init__(self, filename=None, baseAddress = 0): </span>
<span class="lineNum">  259</span><span class="lineNoCov">      0  /   1:         BaseFile.__init__(self, baseAddress = baseAddress) </span>
<span class="lineNum">  260</span><span class="lineNoCov">      0  /   1:         self.filename = filename </span>
<span class="lineNum">  261</span>              :  </span>
<span class="lineNum">  262</span><span class="lineNoCov">      0  /   1:         self.archStr = &quot;intel&quot; </span>
<span class="lineNum">  263</span><span class="lineNoCov">      0  /   1:         self.objdumpLines = [] </span>
<span class="lineNum">  264</span><span class="lineNoCov">      0  /   1:         self.nmLines = [] </span>
<span class="lineNum">  265</span><span class="lineNoCov">      0  /   1:         self.objdumpSourceLines = [] </span>
<span class="lineNum">  266</span>              :  </span>
<span class="lineNum">  267</span><span class="lineNoCov">      0  /   1:         if filename != None: </span>
<span class="lineNum">  268</span><span class="lineNoCov">      0  /   1:             f = open(filename, &#039;rb&#039;) </span>
<span class="lineNum">  269</span><span class="lineNoCov">      0  /   1:             self.archStr = pickle.load(f) </span>
<span class="lineNum">  270</span><span class="lineNoCov">      0  /   1:             self.nmLines = pickle.load(f) </span>
<span class="lineNum">  271</span><span class="lineNoCov">      0  /   1:             self.objdumpLines = pickle.load(f) </span>
<span class="lineNum">  272</span><span class="lineNoCov">      0  /   1:             self.objdumpSourceLines = pickle.load(f) </span>
<span class="lineNum">  273</span><span class="lineNoCov">      0  /   1:             f.close() </span>
<span class="lineNum">  274</span>              :  </span>
<span class="lineNum">  275</span><span class="lineNoCov">      0  /   1:             self.arch = dissy.architecture.getArchitecture(self.getArchStr()) </span>
<span class="lineNum">  276</span><span class="lineNoCov">      0  /   1:             if self.hasSymbols(): </span>
<span class="lineNum">  277</span><span class="lineNoCov">      0  /   1:                 self.parse() </span>
<span class="lineNum">  278</span>              :             else: </span>
<span class="lineNum">  279</span><span class="lineNoCov">      0  /   1:                 self.parseNoSymbols() </span>
<span class="lineNum">  280</span>              :  </span>
<span class="lineNum">  281</span><span class="lineCov">      1  /   1:     def getArchStr(self): </span>
<span class="lineNum">  282</span><span class="lineNoCov">      0  /   1:         return self.archStr </span>
<span class="lineNum">  283</span>              :  </span>
<span class="lineNum">  284</span><span class="lineCov">      1  /   1:     def getNmLines(self): </span>
<span class="lineNum">  285</span><span class="lineNoCov">      0  /   1:         return self.nmLines </span>
<span class="lineNum">  286</span>              :  </span>
<span class="lineNum">  287</span><span class="lineCov">      1  /   1:     def getObjdumpLines(self): </span>
<span class="lineNum">  288</span><span class="lineNoCov">      0  /   1:         return self.objdumpLines </span>
<span class="lineNum">  289</span>              :  </span>
<span class="lineNum">  290</span><span class="lineCov">      1  /   1:     def getFunctionObjdump(self, funclabel, start, end): </span>
<span class="lineNum">  291</span><span class="lineNoCov">      0  /   1:         infunc = False </span>
<span class="lineNum">  292</span><span class="lineNoCov">      0  /   1:         startlinere = re.compile(&quot;^[0]*%Lx &lt;%s&gt;:&quot; % (start, funclabel)) </span>
<span class="lineNum">  293</span><span class="lineNoCov">      0  /   1:         endlinere = re.compile(&quot;^[0]*%Lx &lt;.*&gt;:&quot; % (end)) </span>
<span class="lineNum">  294</span><span class="lineNoCov">      0  /   1:         lastline = None </span>
<span class="lineNum">  295</span><span class="lineNoCov">      0  /   1:         for line in self.objdumpSourceLines: </span>
<span class="lineNum">  296</span><span class="lineNoCov">      0  /   1:             if not infunc: </span>
<span class="lineNum">  297</span><span class="lineNoCov">      0  /   1:                 r = startlinere.match(line) </span>
<span class="lineNum">  298</span><span class="lineNoCov">      0  /   1:                 if r != None: </span>
<span class="lineNum">  299</span><span class="lineNoCov">      0  /   1:                     infunc = True </span>
<span class="lineNum">  300</span><span class="lineNoCov">      0  /   1:                     lastline = line </span>
<span class="lineNum">  301</span><span class="lineNoCov">      0  /   1:             elif infunc: </span>
<span class="lineNum">  302</span><span class="lineNoCov">      0  /   1:                 r = endlinere.match(line) </span>
<span class="lineNum">  303</span><span class="lineNoCov">      0  /   1:                 if r != None: </span>
<span class="lineNum">  304</span><span class="lineNoCov">      0  /   1:                     return </span>
<span class="lineNum">  305</span>              :                 else: </span>
<span class="lineNum">  306</span><span class="lineNoCov">      0  /   1:                     yield lastline </span>
<span class="lineNum">  307</span><span class="lineNoCov">      0  /   1:                     lastline = line </span>
<span class="lineNum">  308</span>              :         #this means we reached the end of the dump, also yield the last line </span>
<span class="lineNum">  309</span><span class="lineNoCov">      0  /   1:         if lastline: </span>
<span class="lineNum">  310</span><span class="lineNoCov">      0  /   1:             yield lastline </span>
<span class="lineNum">  311</span>              :  </span>
<span class="lineNum">  312</span><span class="lineCov">      1  /   1:     def saveTo(self, f): </span>
<span class="lineNum">  313</span><span class="lineNoCov">      0  /   1:         pickle.dump(self.archStr, f, -1) </span>
<span class="lineNum">  314</span><span class="lineNoCov">      0  /   1:         pickle.dump(self.nmLines, f, -1) </span>
<span class="lineNum">  315</span><span class="lineNoCov">      0  /   1:         pickle.dump(self.objdumpLines, f, -1) </span>
<span class="lineNum">  316</span><span class="lineNoCov">      0  /   1:         pickle.dump(self.objdumpSourceLines, f, -1) </span>
<span class="lineNum">  317</span>              :  </span>
<span class="lineNum">  318</span><span class="lineCov">      1  /   1:     def __str__(self): </span>
<span class="lineNum">  319</span><span class="lineNoCov">      0  /   1:         out = &quot;%s: &quot; % (self.filename) </span>
<span class="lineNum">  320</span><span class="lineNoCov">      0  /   1:         for fn in self.functions: </span>
<span class="lineNum">  321</span><span class="lineNoCov">      0  /   1:             out = out + str(fn) </span>
<span class="lineNum">  322</span><span class="lineNoCov">      0  /   1:         return out </span>
<span class="lineNum">  323</span>              :  </span>
<span class="lineNum">  324</span><span class="lineCov">      1  /   1: if __name__ == &quot;__main__&quot;: </span>
<span class="lineNum">  325</span><span class="lineNoCov">      0  /   1:     if len(sys.argv) &lt; 2: </span>
<span class="lineNum">  326</span><span class="lineNoCov">      0  /   1:         print &quot;Arg: filename (ELF)&quot; </span>
<span class="lineNum">  327</span><span class="lineNoCov">      0  /   1:         sys.exit(1) </span>
<span class="lineNum">  328</span><span class="lineNoCov">      0  /   1:     f = File(sys.argv[1]) </span>
<span class="lineNum">  329</span><span class="lineNoCov">      0  /   1:     f.parse() </span>
<span class="lineNum">  330</span>              :  </span>
<span class="lineNum">  331</span>              :  </span>
<span class="lineNum">  332</span>              : # Module-global file object </span>
<span class="lineNum">  333</span><span class="lineCov">      1  /   1: global_file = None </span>
<span class="lineNum">  334</span>              :  </span>
<span class="lineNum">  335</span><span class="lineCov">      1  /   1: def getArchStr(): return global_file.getArchStr() </span>
<span class="lineNum">  336</span>              :  </span>
<span class="lineNum">  337</span><span class="lineCov">      1  /   1: def lookup(param): return global_file.lookup(param) </span>
<span class="lineNum">  338</span>              :  </span>
<span class="lineNum">  339</span><span class="lineCov">      1  /   1: def getFunctions(): return global_file.getFunctions() </span>
<span class="lineNum">  340</span>              :  </span>
<span class="lineNum">  341</span><span class="lineCov">      1  /   1: def getData(): return global_file.getData() </span>
</pre>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr><td class="ruler"><img src="glass.png" width="3" height="3" alt=""/></td></tr>
  <tr><td class="versionInfo">Generated by: <a href="http://simonkagstrom.github.com/kcov/index.html">Kcov</a></td></tr>
</table>
<br/>
</body>
</html>
